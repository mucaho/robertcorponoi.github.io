<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">

<head>
  <title>Creating a Loot System - Robert Corponoi</title><meta name="gridsome:hash" content="47d7bfa9cc677b08964215c6823fc4fdd52ee50c"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" data-key="description" name="description" content="My Blog"><meta data-vue-tag="ssr" name="description" content="Learn how to easily create a loot system for enemies and chests."><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.bd9c2d4c76737c8e645df615f326643d.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.bd9c2d4c76737c8e645df615f326643d.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.bd9c2d4c76737c8e645df615f326643d.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.bd9c2d4c76737c8e645df615f326643d.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.bd9c2d4c76737c8e645df615f326643d.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.bd9c2d4c76737c8e645df615f326643d.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.bd9c2d4c76737c8e645df615f326643d.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.bd9c2d4c76737c8e645df615f326643d.png"><link rel="preload" href="/assets/css/0.styles.5f7ee5ed.css" as="style"><link rel="preload" href="/assets/js/app.1b9cc82c.js" as="script"><link rel="preload" href="/assets/js/page--src-templates-post-vue.ed68cdd5.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules-gridsome-app-pages-404-vue.908abdee.js"><link rel="prefetch" href="/assets/js/page--src-pages-contact-vue.c872c1ab.js"><link rel="prefetch" href="/assets/js/page--src-pages-index-vue.f7a8b6be.js"><link rel="prefetch" href="/assets/js/page--src-templates-tag-vue.23efd461.js"><link rel="stylesheet" href="/assets/css/0.styles.5f7ee5ed.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
</head>

<body >
  <script>
    /**
     * Add dark/light mode detection that runs before Vue.js loads. Borrowed
     * from overreacted.io
     */
    (() => {
      window.__onThemeChange = () => { };

      /**
       * Changes the theme by changing a data-attribute on the body.
       * 
       * @param {string} newTheme The new theme to change to.
       */
      const setTheme = (newTheme) => {
        window.__theme = newTheme;
        preferredTheme = newTheme;

        document.body.setAttribute('data-theme', newTheme);
        window.__onThemeChange(newTheme);
      };

      // Get the existing theme from the local storage, if there is one.
      const preferredTheme = localStorage.getItem('theme');
      if (!preferredTheme) return;

      /**
       * Calls `setTheme` to change the data attribute on the body to adjust
       * for the new theme and then it sets it to the local storage so that
       * next time the user visits the page the theme is remembered.
       * 
       * @param {string} newTheme The new theme to change to.
       */
      window.__setPreferredTheme = (newTheme) => {
        setTheme(newTheme);
        localStorage.setItem('theme', newTheme);
      };

      // Check to see if we should be in dark mode automatically by the user's
      // preferred color theme.
      const darkQuery = window.matchMedia('(prefers-color-scheme: dark)');
      darkQuery.addListener(e => {
        // Change the theme if the user prefers one or the other automatically.
        window.__setPreferredTheme(e.matches ? 'dark' : 'light')
      });

      setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
    })();
  </script>
  <div id="app" data-server-rendered="true"><nav class="navbar"><div class="container"><a href="/" class="navbar__logo">RC</a><span id="navbar-toggle" class="navbar__toggle"><div id="nav-icon" class="nav-icon"><div></div></div></span><ul id="navbar-main" class="navbar__main hide"><li><a href="/tag/game-development" class="navbar__links">Game Development</a></li></ul></div></nav><div class="header"><button role="button" aria-label="Toggle dark/light" class="toggle-theme"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></button></div><main class="main"><div class="post container"><div class="post__header"><h1 class="post__title">Creating a Loot System</h1><div class="post-meta post__meta">
  24. July 2020
  <strong>23 min parse.</strong></div><img alt="Cover image" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 850 604' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-40af2268e2dfe4871592795e26ffcc9d'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='10'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-40af2268e2dfe4871592795e26ffcc9d)' width='850' height='604' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAtCAYAAAAeA21aAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAJaElEQVRo3u2X%2bVMVVxbH%2b3/JhH15G29hExUQtyDiHmURgQfIFozLjGilBjURoqKSMZXJ1ERTxgVxi4JixklMohNnfpjRGsQddSTqVCaymKmo%2bc45t2%2b/1930AzUVmSr94VP33HNvn3O%2bp7vv66fsvdAHA133saerT6K3CVrfLbg/lC4juwx8b2B3Vz8%2b6foXcVvY5vVdpusNsS%2bEQq3PUK%2bsf2%2bXSSPRKlH2dd9Ha3fQoRHcfD%2bAGtDUlCHN6RumSI0BIV40gOyR9/eFEGgUyzcvWK9RaIBuFda9j/YpbTRp44mZC9wYgscnaI5guAYZ7soA3dnbRK%2bwn%2bQaozij0FZLVA1mXW0B%2bgTK/ot92N8dpG0IFs2RqM2xblKr%2bdXSFd0q7vptuqO9wjYLCnn3pDA9VnXpBWroNQrNxAFCOXixHxoHDMiN3SM1SGXfMI3SP1UqLPo20SvsoH/kGG3D1BBKpF6XXu8hbsDhS33QOKSHFg8KQjVI1ySLRg33RO3vHqDXq1fAdlsIYZYxQwgzi9MEHjLpCurtFyhHLvdDz6eXjBwOELpRVs0yc4CKF4h9g2i72Et8K2whxrAeOo6WbyRhZh1mnUclSseVAWi0C/rRflnlqIkhzbJo2NDGcdH3cYRjX3sg7MPijt0WsH2o%2b3uKN4CjVx/QvE9Fd32oHEcuhxamoWlpl/o6TCidVwegcdzEMeZKkA4L2vVctm5e542H2PP3O/jozHV0XP8vjvc8RnvPd8R/cKznETpvPkTruX9jxzc30H71B3Rc%2b2GoACEitJCOK8ZaBRaaOk0of7o2CD2fWXDi2gBOXDXSacFxqyZS0R8easeKDw%2bitnkHNu/Yjq2f7MHmnWTv/Bhbdu7Ce7t2Y3XL%2b6h67wCaPt6L/X%2b9hBM91Ci6diQBnaa6RK2EWYNZ50nm%2biCUL3oeIMggPmeuG/mzBSfNyKDBJAM42UN388Jd1K9ZgaqNH6GuqQUrVi7GsvoaLJeodhWWv7UM1S2tqF5dj9%2b3HcCpXuCzq/3Ggq8NzWtV2%2bcWsDaVoN5ThPL1zQcQ3DDyVQi%2b1NNj5JSOLyjpV7d%2bxLHzt7C0vg7ljX9AZUMTlv2mSsyX1r8hUe0lK2lP0x9RUb8aLTt24My3P1GMAYo1aIhrzqnVEqrer60gvaclytlbD6Dnm2H4y80n58yNQZztfYgT52%2biss6PkjXbULaqAdV1JahaUo6qulKJH9VLyshXgZJ1H6Bo6a%2bx6YP38bc7P%2bH0jQGceYqcos6b1rWfDYFy/t5jnL/3CGK8%2byho83g3aJ%2b7q9tzV87laMU/7jzEP78DTl%2b%2bh/IaP%2ba9sRr5NUtQUrYAJRVF8NdUwF9bgdJqak55AYrLF2L%2bm7/FvFI/frd9O%2bjTgGL8aIip1XEuUKe%2bxscW9er26NYC%2bwnl7Q1b8M7GLeCxcVOLtDeL%2bXqai3Vpr2tqFmvr3pWjnL/9rrQDY7MY16zfiLWNzah9sxZFpfNRXFYgGrCoshx5KzdhQX0z8pc3kD9frC3y5wt7dcM6rOXrGzeKGGIkGtZvIP8mYa9t3CTgPFouzt/wzgZR33qphWlsbsGGLdvI3kr%2brWLUUGbPmom5c2ZjZu50zJ45QzBrxgzMoPnMGblyJB/5p%2bdMQ25OjvDnTMumeQ5yp%2bcIH895L%2b9R13ichuypryG/8HX4KxeitKIQpeUksnoxFqzaQrSgYPka8hWoa5LcXIqXnS2un5atxuI8HJdzcR5eY5/ISbZWL69z/axL882ZPUvVRcybO0fYvMZzZdLkKdDImjgJEydNpnEyjVOQMWEiMjWyJol5emaWGDMyVTudxvEZWRiXPgFjx2cG4Dn708ZlYNbcmSirLKJHvVCILVlcJJqwiCiu9JOvkF4LVTzvyaQ6tBiBmOnqOD5DjcujyJ%2bhkiFqUWtLpzWul3Vw7ROkzZo0H4%2bTp0yFkpQyFt6kMfAlp8GXkgYvjTz3JqXBI/2a7U5MFTaPCb5UuLwpcHqSVchmn1iT6%2byLd/owJWcqNYDEleWRwHwiD6Vl8yULpC9fPB2LSheIXHZ3koghsMjn8mn5xgRq4lHUHtCg2j6JpicpdSySx4wTKBzMIQU4PSlBWybjQmwJKvGuRMS5fIhzqvDcRut2txqD7TjyxdIaw3ZUvBsT6bEsrS1HUWUpvf/%2bkBRX%2bVFQVgwH5Y5xeA1xOL9d1KPWJGpxBmtR98h9tK7X4XCrNjfQod0w1k1%2bhS%2bMl0Vz0mjG7kGUHpsHkTZ1jLZ7ESMTxhJs855IscctR7mf9oZF25E%2buxgFb23D/JXNdPBttmblZuSt2op5y5sQ50lFRFyCLq4W2y18MQ6fyK01m2vW9kbZTLUTvM7atLo1zfHULIXvUCQRZUGkbi2GxMRyYoJtsU5FcqE8ansjtTkLoPmrUQ5kZOeiuG4JCquqsbC6JiRFNbXIr6ikApMQHusyxQvGj9DFjybBsQ61NnEDuQGilgRLXXpNvFfxxnvBeASeAF6bF4n2RCQ6EuElEu0%2bsccd51ER%2b7zDQzFc0QmYOjELi6sL4a/IQ1lFvo48g12%2bmH4hSl5HojNJ5BgxfrwnUA/PfVQjk%2bRQ6/bZgjUHdEm9mmYljDqpEc7d4ceGHymCbfYZ9%2biIGwF%2bAuhOOujAGpdFvwiZE5A2geCTfDKd6NmvCVv4aG0sjSnjMxBhcwdzjZhDxVxjhHwFNS0812vRrlXE4yDfqxjtXSKfloAftwiaB4hzG%2bfDIa8Noya8Eu3ErySvRDoR4bQjIjFN2AG/HAM5nyaXqcZA/fHquSTOLnkW8DkRITUq2gESoRMdbhJtnj8N5mv5IAunAmM9LsSmjqN3XfWNdN2z5jM/MeoN9wYOfCWU6J8rPDQJQnQMNSCGvkHCY3%2bJHE/WDPYpz0f06DRgJF3iFXg%2boodrgPs55h7aEOX5J9c3gM6AmATDgfm8Gb0GuB2ISR5DP0WJJN41KuJHsQH0s5tgR0xSKsJtKaPbgBE/NH4BwugJiKYGRCelIMyWTD4nRqMOcQjq/7w8KdqHU7T25%2bkpUD%2b2fLB5XYinv6VRrjT6b8F/WJ4t3s9F4S%2bkp0L34fQsqB9C9AeGzoDYZHoF7Cn0cfIivQLx6iugnQFhdAaE0xkQHucenVdg1H4F/l8OwVFtAL8CdAi%2bmA3g7wCfD%2bGOsS9qA5z0NUi2K/0Fb4Az/eUT8LIBLxvwsgEvGzBaDfgf0OTBFGlzKt4AAAAASUVORK5CYII=' /%3e%3c/svg%3e" width="850" data-src="/assets/static/chest.c521340.dec358a6bf7cb7fed011d4e39cb34716.png" data-srcset="/assets/static/chest.a67b0b2.dec358a6bf7cb7fed011d4e39cb34716.png 480w, /assets/static/chest.c521340.dec358a6bf7cb7fed011d4e39cb34716.png 850w" data-sizes="(max-width: 850px) 100vw, 850px" class="post__image g-image g-image--lazy g-image--loading"><noscript><img src="/assets/static/chest.c521340.dec358a6bf7cb7fed011d4e39cb34716.png" class="post__image g-image g-image--loaded" width="850" alt="Cover image"></noscript></div><div class="post__content"><h2 id="getting-started"><a href="#getting-started" aria-hidden="true"><span class="icon icon-link"></span></a>Getting Started</h2>
<p>If you're making a game that involves the player killing and looting enemies or looting chests then you're probably wondering of a good way to create a loot system for it. There's a couple approaches to this. You could of course just have an array of items that the enemy or chest drops but the problem with that everything has the same weight. Imagine that you wanted a monster to drop some coins and maybe a piece of armor but there's varying levels of armor. You want the boss to drop a low level piece of armor most of the time you want to give the player something to work towards if they want to so ever so often you want a monster to drop a higher level piece of armor. In order to accomplish this you'll need to create a loot table with weighted options but it's actually easier than it looks and it can be done in two parts. The completed project can be found on my GitHub at <a href="https://github.com/robertcorponoi/godot-loot-system" target="_blank" rel="nofollow noopener noreferrer">robertcorponoi/godot-loot-system</a>. Also this article was inspired by <a href="https://www.codeproject.com/Articles/420046/Loot-Tables-Random-Maps-and-Monsters-Part-I" target="_blank" rel="nofollow noopener noreferrer">this</a> so check it out to see a slightly different approach (in C#).</p>
<p><strong>Note:</strong> While this article covers how to do it in Godot, this can be easily ported to any other engine as its just 2 simple classes.</p>
<h2 id="part-1---the-items"><a href="#part-1---the-items" aria-hidden="true"><span class="icon icon-link"></span></a>Part 1 - The Items</h2>
<p>The first things we need to do is create the class for the items that go in the loot tables. For this, we need to decide what basic properties all of our items will need and it can be boiled down to the following:</p>
<ul>
<li><strong>probability</strong>: The single most important part of our item is the probability. This is just a number, any number you wish. A probability of 1 is very low and chances are the item won't be rolled often while a probability of 100 me
ans that item will probably be rolled more often. An important thing to note is that this is not a percentage so don't think of it that way. Probability can be 5 or 4500, it's all relative to the probabilities of the other items on the loot table.</li>
<li><strong>is_unique</strong>: This is used to indicates whether an item is unique or not. If an item is unique then it cannot be rolled twice. For example, if you have a piece of rare armor on your drop table you don't want it to be able to be rolled twice while on the other hand you might a drop of leather boots to drop more than once.</li>
<li><strong>always_drop</strong>: This indicates whether the item should always be rolled. For example, your monster might drop bones and that would be a drop that always happens.</li>
<li><strong>is_enabled</strong>: This indicates whether the item is currently able to be rolled or not. This enables you to enable/disable drops whenever you wish.</li>
<li><strong>item</strong>: The data of the item to put on the loot table. Since there's so many ways to represent the data in your game it all gets set in this property in any way you wish. I personally prefer using a dictionary with the name and stats of the item but you could also just change <code>item</code> to <code>id</code> and use and id that you can check against a database when it's rolled.</li>
</ul>
<p>Now that we have our item's properties, let's put them in a <code>LootItem</code> class in a new script named <code>loot_item.gd</code>:</p>
<pre class="language-gdscript"><code class="language-gdscript"><span class="token keyword">extends</span> <span class="token class-name">Resource</span>

<span class="token comment"># A LootItem defines an item that goes on a DropTable and it contains an item's</span>
<span class="token comment"># properties and it's chance of being hit along with other variables that define</span>
<span class="token comment"># how often it gets hit.</span>
<span class="token keyword">class_name</span> <span class="token class-name">LootItem</span>

<span class="token comment"># The data that represents the properties of this item.</span>
<span class="token keyword">var</span> item
<span class="token comment"># The probability that this item will be selected.</span>
<span class="token keyword">var</span> probability<span class="token punctuation">:</span> <span class="token class-name">int</span>
<span class="token comment"># Indicates whether this item is unique or not. A unique item will only drop</span>
<span class="token comment"># once per roll.</span>
<span class="token keyword">var</span> is_unique<span class="token punctuation">:</span> <span class="token class-name">bool</span>
<span class="token comment"># Indicates whether this item should drop every time or not.</span>
<span class="token keyword">var</span> should_drop_always<span class="token punctuation">:</span> <span class="token class-name">bool</span>
<span class="token comment"># Indicates whether this item is eligible to be rolled or not.</span>
<span class="token keyword">var</span> is_enabled<span class="token punctuation">:</span> <span class="token class-name">bool</span>

<span class="token comment"># To create a LootItem we need the item's data, its probability, whether it's</span>
<span class="token comment"># unique or not, if it should always be rolled, and whether it's currently</span>
<span class="token comment"># enabled or not.</span>
<span class="token comment">#</span>
<span class="token comment"># Arguments:</span>
<span class="token comment">#</span>
<span class="token comment"># `u_item` - The data that represents the properties of this item.</span>
<span class="token comment"># `u_probability` - The probability that this item will be selected.</span>
<span class="token comment"># `unique` - Indicates whether this item is unique or not. A unique item will only drop once per roll.</span>
<span class="token comment"># `always` - Indicates whether this item should drop every time or not.</span>
<span class="token comment"># `enabled` - Indicates whether this item is eligible to be rolled or not.</span>
<span class="token keyword">func</span> <span class="token function">_init</span><span class="token punctuation">(</span>u_item<span class="token punctuation">,</span> u_probability<span class="token punctuation">:</span> <span class="token class-name">int</span><span class="token punctuation">,</span> unique<span class="token punctuation">:</span> <span class="token class-name">bool</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> always_drop<span class="token punctuation">:</span> <span class="token class-name">bool</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> enabled<span class="token punctuation">:</span> <span class="token class-name">bool</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	item <span class="token operator">=</span> u_item
	probability <span class="token operator">=</span> u_probability
	is_unique <span class="token operator">=</span> unique
	should_drop_always <span class="token operator">=</span> always_drop
	is_enabled <span class="token operator">=</span> enabled</code></pre>
<p>Just like that, the first part is done. Notice how there's nothing fancy in the <code>LootItem</code> class, it's just a collection of properties that the loot table will use to decide if this item is rolled or not.</p>
<h2 id="part-2---the-table"><a href="#part-2---the-table" aria-hidden="true"><span class="icon icon-link"></span></a>Part 2 - The Table</h2>
<p>The loot table is what's going to be rolled and will decide which items should be rolled. Let's see what properties we'll need out of our loot tables:</p>
<ul>
<li><strong>name</strong>: While this isn't necessary it's nice to give some context to our table (kind of like the item is defined by its item property).</li>
<li><strong>num_of_items_to_roll</strong>: This is the most important part of the table, this lets the table know how many items that it should roll for.</li>
<li><strong>table_contents</strong>: This is where all of the items in the table are stored.</li>
<li><strong>unique_drops</strong>: We need to keep track of which unique drops have been rolled because we do not want a unique drop to be rolled twice.</li>
</ul>
<p>Alright that's all of the basic properties of the table to let's set up the basic properties and constructor in a class named <code>LootTable</code> in a file named <code>loot_table.gd</code>:</p>
<pre class="language-gdscript"><code class="language-gdscript"><span class="token keyword">extends</span> <span class="token class-name">Resource</span>

<span class="token comment"># A LootTable defines a table that holds one or more LootItems and it</span>
<span class="token comment"># can roll to return one or more items.</span>
<span class="token keyword">class_name</span> <span class="token class-name">LootTable</span>

<span class="token comment"># The name of this loot table.</span>
<span class="token keyword">var</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span>
<span class="token comment"># Indicates the amount of items that will be rolled off this table.</span>
<span class="token keyword">var</span> num_of_items_to_roll<span class="token punctuation">:</span> <span class="token class-name">int</span>
<span class="token comment"># The LootItems in this table.</span>
<span class="token keyword">var</span> table_contents<span class="token punctuation">:</span> <span class="token class-name">Array</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token comment"># Any unique drops are added here when they are hit so that they cannot drop a</span>
<span class="token comment"># second time.</span>
<span class="token keyword">var</span> unique_drops<span class="token punctuation">:</span> <span class="token class-name">Array</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment"># To create a new table we need to provide it with a name and specify the amount</span>
<span class="token comment"># of items within it.</span>
<span class="token comment">#</span>
<span class="token comment"># Arguments:</span>
<span class="token comment">#</span>
<span class="token comment"># `u_name` - The name of this table.</span>
<span class="token comment"># `num_items` - The amount of items that this table should roll for.</span>
<span class="token keyword">func</span> <span class="token function">_init</span><span class="token punctuation">(</span>u_name<span class="token punctuation">,</span> num_of_items<span class="token punctuation">:</span> <span class="token class-name">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	name <span class="token operator">=</span> u_name
	num_of_items_to_roll <span class="token operator">=</span> num_of_items</code></pre>
<p>Simple enough so far right? Well now we need to create a method to add <code>LootItem</code>s to the <code>table_contents</code> array:</p>
<pre class="language-gdscript"><code class="language-gdscript"><span class="token comment"># Adds an item onto this table.</span>
<span class="token comment">#</span>
<span class="token comment"># Arguments:</span>
<span class="token comment">#</span>
<span class="token comment"># `item` - The LootItem to add to this table.</span>
<span class="token keyword">func</span> <span class="token function">add_item</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> <span class="token class-name">LootItem</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	table_contents<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span></code></pre>
<p>All we do above is add an item to the loot table which is really just adding an item to the end of the <code>table_contents</code> array.</p>
<p>Now that the user can add items to the table, let's get into the more complicated part, rolling for items. Here's an overview of what we need to do when we roll for items:</p>
<ol>
<li>We need to create an array to keep track of the items that have been rolled and we need to reset our <code>unique_drops</code> array in case it contains data from previous rolls.</li>
<li>We need to check the table for items that have <code>should_drop_always</code> set to <code>true</code>. This is because these items need to always drop so we don't need to roll for them.</li>
<li>Get a count of the amount of items we need to roll for. This isn't just the flat out <code>num_of_items_to_roll</code> because of the step above. We need to get the amount of items to roll for after the always drops have been found. For example, let's say that you have your table set to roll for 4 items. However, in your table, there's 2 items that are set to always. In the step above we set these items aside and now the number of items to roll for is 2 not 4.</li>
<li>Now's the fun part, we have to do some looping. The first loop is going to run as many times as we have items left to drop. Then inside it we loop through each item and check to see if it's enabled and that it doesn't already exist in the <code>unique_drops</code> array. After we get a list of the items that are eligible to be rolled for, we calculate the <code>hit_probability</code> which is going to be a random number from 0 to the total probability of each item in the list of items that can be rolled. We then loop over all of the items that can be rolled for and keep a running tally of probability while we check to see if the <code>hit_probability</code> value is less than this running value. Let's take this and expand on it to make sure that you fully understand it.</li>
</ol>
<p>Let's say that for example you have the following 4 items in your loot table:</p>
<table>
<thead>
<tr>
<th><strong>Item</strong></th>
<th><strong>Probability</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Sword</td>
<td>10</td>
</tr>
<tr>
<td>Shield</td>
<td>5</td>
</tr>
<tr>
<td>Bow</td>
<td>15</td>
</tr>
<tr>
<td>Boots</td>
<td>30</td>
</tr>
</tbody>
</table>
<p>These 4 items have a combined probability of 60. If you run a random number generator to get 2 values from 0 to 60 you might get something like: 42 and 15.</p>
<p>Now we loop through each of these items and keep a running tally on their probability while checking to see if the hit value is less than this running tally.</p>
<p>Let's go through the loop:</p>
<table>
<thead>
<tr>
<th><strong>Loop Item</strong></th>
<th><strong>Running Probability Tally</strong></th>
<th><strong>Hit Probability</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Sword</td>
<td>10</td>
<td>42</td>
</tr>
<tr>
<td>Shield</td>
<td>15</td>
<td>42</td>
</tr>
<tr>
<td>Bow</td>
<td>30</td>
<td>42</td>
</tr>
<tr>
<td>Boots</td>
<td>60</td>
<td>42</td>
</tr>
</tbody>
</table>
<p>Now if we're checking if <code>hit_probability &#x3C; running_probability_tally</code> we'll check:</p>
<ol>
<li><code>42 &#x3C; 10</code> - <code>false</code></li>
<li><code>42 &#x3C; 15</code> - <code>false</code></li>
<li><code>42 &#x3C; 30</code> - <code>false</code></li>
<li><code>42 &#x3C; 60</code> - <code>true</code></li>
</ol>
<p>This means that we'll get boots as a drop! Let's run through this again with the other random value, 15.</p>
<ol>
<li><code>15 &#x3C; 10</code> - <code>false</code></li>
<li><code>15 &#x3C; 15</code> - <code>false</code></li>
<li><code>15 &#x3C; 30</code> - <code>true</code></li>
</ol>
<p>Now we get a bow as our drop.</p>
<p>Let's get into the code and see how it's done now that we got the theory set up. Let's add a new method below our constructor:</p>
<pre class="language-gdscript"><code class="language-gdscript"><span class="token comment"># Adds a table within this table. This is the same as adding an item but for</span>
<span class="token comment"># naming sake it exists as its own method.</span>
<span class="token keyword">func</span> <span class="token function">add_table</span><span class="token punctuation">(</span>table<span class="token punctuation">:</span> <span class="token class-name">LootTable</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	table_contents<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span>

<span class="token comment"># Rolls the table (and any nested tables) for LootItems and adds the rolled</span>
<span class="token comment"># items into the `results` array.</span>
<span class="token keyword">func</span> <span class="token function">roll_table</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># The list of items that have been rolled. We also reset the unique_drops</span>
	<span class="token comment"># array in case it was populated from previous rolls.</span>
	<span class="token keyword">var</span> rolled_items<span class="token punctuation">:</span> <span class="token class-name">Array</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	unique_items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	
	<span class="token comment"># First we look for items that are always hit. These items are always</span>
	<span class="token comment"># returned and there is a chance that we can break the `count` limit if the</span>
	<span class="token comment"># number of always items is greater than the number of items to roll for.</span>
	<span class="token keyword">var</span> num_of_items_always_rolled<span class="token punctuation">:</span> <span class="token class-name">int</span> <span class="token operator">=</span> <span class="token number">0</span>
	<span class="token keyword">for</span> loot <span class="token keyword">in</span> table_contents<span class="token punctuation">:</span>
		<span class="token keyword">if</span> loot<span class="token punctuation">.</span>should_drop_always <span class="token keyword">and</span> loot<span class="token punctuation">.</span>is_enabled<span class="token punctuation">:</span>
			<span class="token function">add_to_rolled_items</span><span class="token punctuation">(</span>rolled_items<span class="token punctuation">,</span> loot<span class="token punctuation">)</span>
			num_of_items_always_rolled <span class="token operator">+=</span> <span class="token number">1</span>
	
	<span class="token comment"># Now after we got all of the always items, we have to see how many more</span>
	<span class="token comment"># items we can roll for.</span>
	<span class="token keyword">var</span> real_drop_count<span class="token punctuation">:</span> <span class="token class-name">int</span> <span class="token operator">=</span> num_of_items_to_roll <span class="token operator">-</span> num_of_items_always_rolled
	
	<span class="token comment"># Roll for more items if we still can.</span>
	<span class="token keyword">if</span> real_drop_count <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>
		<span class="token keyword">for</span> _i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span>real_drop_count<span class="token punctuation">)</span><span class="token punctuation">:</span>
			<span class="token comment"># Find the items in the table that are eligible to be rolled and</span>
			<span class="token comment"># were not rolled earlier.</span>
			<span class="token keyword">var</span> loot_that_can_be_rolled<span class="token punctuation">:</span> <span class="token class-name">Array</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
			<span class="token keyword">var</span> total_probability <span class="token operator">=</span> <span class="token number">0</span>
			<span class="token keyword">for</span> table_content <span class="token keyword">in</span> table_contents<span class="token punctuation">:</span>
				<span class="token keyword">if</span> table_content<span class="token punctuation">.</span>is_enabled <span class="token keyword">and</span> <span class="token keyword">not</span> table_content<span class="token punctuation">.</span>should_drop_always<span class="token punctuation">:</span> 
					loot_that_can_be_rolled<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>table_content<span class="token punctuation">)</span>
					total_probability <span class="token operator">+=</span> table_content<span class="token punctuation">.</span>probability
			
			<span class="token comment"># We calculate the the number that we'll compare to the probability</span>
			<span class="token comment"># of the items to decide what item is rolled by picking a random</span>
			<span class="token comment"># float from 0.0 to the total probability of all the items that can be rolled.</span>
			<span class="token keyword">var</span> hit_value<span class="token punctuation">:</span> <span class="token class-name">float</span> <span class="token operator">=</span> <span class="token function">rand_range</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> total_probability<span class="token punctuation">)</span>
			
			<span class="token comment"># Now we have to go through the list of items that can be rolled and increase</span>
			<span class="token comment"># the probability until we find an item that meets the hit_value.</span>
			<span class="token keyword">var</span> running_value<span class="token punctuation">:</span> <span class="token class-name">int</span> <span class="token operator">=</span> <span class="token number">0</span>
			<span class="token keyword">for</span> loot <span class="token keyword">in</span> loot_that_can_be_rolled<span class="token punctuation">:</span>
				running_value <span class="token operator">+=</span> loot<span class="token punctuation">.</span>probability
				<span class="token keyword">if</span> hit_value <span class="token operator">&lt;</span> running_value<span class="token punctuation">:</span>
					<span class="token function">add_to_rolled_items</span><span class="token punctuation">(</span>rolled_items<span class="token punctuation">,</span> loot<span class="token punctuation">)</span>
					<span class="token keyword">break</span>
	
	<span class="token comment"># Finally we return the results of the roll.</span>
	<span class="token keyword">return</span> rolled_items</code></pre>
<p>Everything above is what we covered before but you'll notice something missing, what's <code>add_to_rolled_items</code>? This is the method that checks if the item is unique and if so checks the unique items array to see if this item already exists there. Otherwise it adds it to the <code>rolled_items</code> array. You're probably wondering why this method is even separate but we'll add some more advanced functionality later.</p>
<pre class="language-gdscript"><code class="language-gdscript"><span class="token comment"># Since we can nest tables we need to perform some checks before we just add</span>
<span class="token comment"># items to the results.</span>
<span class="token comment">#</span>
<span class="token comment"># Arguments:</span>
<span class="token comment">#</span>
<span class="token comment"># `rolled_items` - The array to append the loot to.</span>
<span class="token comment"># `loot` - The LootItem to check.</span>
<span class="token keyword">func</span> <span class="token function">add_to_rolled_items</span><span class="token punctuation">(</span>rolled_items<span class="token punctuation">:</span> <span class="token class-name">Array</span><span class="token punctuation">,</span> loot<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># First we only want to proceed if them is not unique or if it is unique it</span>
	<span class="token comment"># cannot exist in the unique_drops array.</span>
	<span class="token keyword">if</span> <span class="token keyword">not</span> loot<span class="token punctuation">.</span>is_unique <span class="token keyword">or</span> <span class="token keyword">not</span> unique_items<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>loot<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token comment"># If this is a new unique drop then we add it to the unique drops array.</span>
		<span class="token keyword">if</span> loot<span class="token punctuation">.</span>is_unique<span class="token punctuation">:</span> unique_items<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>loot<span class="token punctuation">)</span>
		
		<span class="token comment"># We add the item to the results array and emit the signal for when an </span>
		<span class="token comment"># item has been hit.</span>
		add_to_rolled_items<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>loot<span class="token punctuation">)</span></code></pre>
<p>That's all for the current functionality. With everything we've covered we can create loot items and add them to a loot table and roll for items, which is what we'll do next.</p>
<h2 id="lets-roll"><a href="#lets-roll" aria-hidden="true"><span class="icon icon-link"></span></a>Let's Roll!</h2>
<p>Alright now that we have the scaffolding let's make a demo. Create a new script named <code>main.gd</code> and let's get started. Here's what we have to do:</p>
<ol>
<li>Create an instance of a <code>LootTable</code>.</li>
<li>Create instances of <code>LootItem</code> for all of the items we want to add to the table created in step 1.</li>
<li>Roll for items!</li>
</ol>
<p>Pretty simple right? Let's get it in code:</p>
<pre class="language-gdscript"><code class="language-gdscript"><span class="token keyword">extends</span> <span class="token class-name">Node</span>

<span class="token comment"># Run this on ready so we can see the results right away.</span>
<span class="token keyword">func</span> <span class="token function">_ready</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># We need to call `randomize()` so that we don't get the same results every # # time because random isn't really random.</span>
	<span class="token function">randomize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 

	<span class="token comment"># Create a loot table named "Boss" that's meant to roll 3 items at a time.</span>
	<span class="token keyword">var</span> boss_loot_table<span class="token punctuation">:</span> <span class="token class-name">LootTable</span> <span class="token operator">=</span> LootTable<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Boss"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>

	<span class="token comment"># Define various items and create LootItem instances of them with the item</span>
	<span class="token comment"># data as the first parameter.</span>
	<span class="token comment"># None of the items are unique or set to drop always for simplicity.</span>
	<span class="token keyword">var</span> sword<span class="token punctuation">:</span> <span class="token class-name">Dictionary</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Sword"</span><span class="token punctuation">,</span>
		<span class="token string">"attack"</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
		<span class="token string">"defence"</span><span class="token punctuation">:</span> <span class="token number">3</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">var</span> sword_loot_item<span class="token punctuation">:</span> <span class="token class-name">LootItem</span> <span class="token operator">=</span> LootItem<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>sword<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
	
	<span class="token keyword">var</span> shield<span class="token punctuation">:</span> <span class="token class-name">Dictionary</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Shield"</span><span class="token punctuation">,</span>
		<span class="token string">"attack"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token string">"defence"</span><span class="token punctuation">:</span> <span class="token number">5</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">var</span> shield_loot_item<span class="token punctuation">:</span> <span class="token class-name">LootItem</span> <span class="token operator">=</span> LootItem<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>shield<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
	
	<span class="token keyword">var</span> bow<span class="token punctuation">:</span> <span class="token class-name">Dictionary</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Bow"</span><span class="token punctuation">,</span>
		<span class="token string">"attack"</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
		<span class="token string">"defence"</span><span class="token punctuation">:</span> <span class="token number">1</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">var</span> bow_loot_item<span class="token punctuation">:</span> <span class="token class-name">LootItem</span> <span class="token operator">=</span> LootItem<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>bow<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
	
	<span class="token keyword">var</span> staff<span class="token punctuation">:</span> <span class="token class-name">Dictionary</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Staff"</span><span class="token punctuation">,</span>
		<span class="token string">"attack"</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
		<span class="token string">"defence"</span><span class="token punctuation">:</span> <span class="token number">2</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">var</span> staff_loot_item<span class="token punctuation">:</span> <span class="token class-name">LootItem</span> <span class="token operator">=</span> LootItem<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>staff<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
	
	<span class="token keyword">var</span> helmet<span class="token punctuation">:</span> <span class="token class-name">Dictionary</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Helmet"</span><span class="token punctuation">,</span>
		<span class="token string">"attack"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token string">"defence"</span><span class="token punctuation">:</span> <span class="token number">7</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">var</span> helmet_loot_item<span class="token punctuation">:</span> <span class="token class-name">LootItem</span> <span class="token operator">=</span> LootItem<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>helmet<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>

	<span class="token comment"># Add the created items 3</span>
	boss_loot_table<span class="token punctuation">.</span><span class="token function">add_item</span><span class="token punctuation">(</span>sword_loot_item<span class="token punctuation">)</span>
	boss_loot_table<span class="token punctuation">.</span><span class="token function">add_item</span><span class="token punctuation">(</span>shield_loot_item<span class="token punctuation">)</span>
	boss_loot_table<span class="token punctuation">.</span><span class="token function">add_item</span><span class="token punctuation">(</span>bow_loot_item<span class="token punctuation">)</span>
	boss_loot_table<span class="token punctuation">.</span><span class="token function">add_item</span><span class="token punctuation">(</span>staff_loot_item<span class="token punctuation">)</span>
	boss_loot_table<span class="token punctuation">.</span><span class="token function">add_item</span><span class="token punctuation">(</span>helmet_loot_item<span class="token punctuation">)</span>

	<span class="token comment"># Roll for items.</span>
	<span class="token keyword">var</span> roll_results<span class="token punctuation">:</span> <span class="token class-name">Array</span> <span class="token operator">=</span> boss_loot_table<span class="token punctuation">.</span><span class="token function">roll_table</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment"># Go through each of the rolled items and print out what we got.</span>
	<span class="token keyword">for</span> rolled_item <span class="token keyword">in</span> roll_results<span class="token punctuation">:</span>
		<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Rolled: "</span><span class="token punctuation">,</span> rolled_item<span class="token punctuation">.</span>item<span class="token punctuation">.</span>name<span class="token punctuation">)</span></code></pre>
<p>The results of running the above should be something like:</p>
<ul>
<li>Helmet</li>
<li>Bow</li>
<li>Shield</li>
</ul>
<p>Of course, you'll get different results than me and you'll get different results each time you run it (unless you take out <code>randomize</code>, <code>randomize</code> guarantees we get a different number each time from <code>rand_range</code>).</p>
<h2 id="whats-next"><a href="#whats-next" aria-hidden="true"><span class="icon icon-link"></span></a>What's Next?</h2>
<p>The current setup works just fine for a table with items but what if you wanted to nest tables in tables?</p>
<p>This might sound strange at first but think about it. Imagine you have a table that has super rare loot but you want people to maybe get lucky and roll this table when they kill a monster. You don't want to put the monster's drops on it because it only has super rare items. The solution is to create a table with a low probability and set it as an item of the monster table. This makes it so that when the monster table is rolled, the super rare table has a chance of being rolled instead of one of the items of the monster.</p>
<p>Here's a simple diagram to illustrate it:</p>
<p><img class="g-image g-image--lazy g-image--loading" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 1123 554' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-a4199fa5a489fb291b4449196edc2d22'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-a4199fa5a489fb291b4449196edc2d22)' width='1123' height='554' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAgCAYAAACinX6EAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAFA0lEQVRo3uWZ%2b1MjNwzH%2bf//mbY/tDDD9Eh79EjI3AH36HAc4Q2BkHcIEB5R/dmrUsXYu9k0hA7dGY0fK9mWLH0t7y48Pj4KpM9wOJTX9qATOlJqXWnh4eEh6by/v5dOpyPtdjspu91uQtRtW/ti77PaeeV9/mnmv76%2bHjPCmAFQnOfy8lL29/el0WhIrVZL2q%2bB0AW9UJzNRmlKpcQDeFC81%2bvJa3xOT09HOx4MATVAq9VK6jZeZkn%2b42PPcxBznJycxEPAGoD4nzUQqpKrq7/L8vKylMtlWVpclK/b21IsluSnH36UUqkkN7eDmc6t41DiAb5RtD7CgHq9/mwewNPvXzkDd6TngKnpjH1zc5NQs9lMgErB%2bDkID7C7/r/DgLOzsycGeBICIObR0ZFcXV0loaCkx4rtm4Ss3DTyk4w7CS9evbe3l40Bt7e3o%2bOPcIAYhCPk8PAwGUj7ITwGCrUpz8/PZWdnJ5FjTH1veWLyobaGKGthTXnWo9gWNYC%2bCIEQMaoD5Hnu7u6kWq3OHFRZC2uaJhOMhoA9jmzdPx5DCO/zT2KANLmsh7WwpmlOo1QMAADBABYNaFBeXFxIpVJJYog6fUrHx8cjJOeY0X6VBXm33VGHnPZB8JKicvowhh0zRnY9rIU1%2besJ8Wsd3tQQUBAkblkYSoEJWto6JTwMDMhozLHjlic0xmAwSJRnYeTnGJz5LY9POpYdE0Le74vJHxwcZN8FcCsWl8cV4Uf5fr8/sRzzYWhkAN15p8KpecAILZOYHUp5vShrLlsje9v6%2bCl5Z/kxgM0fNK4/bm1KoVCQd6t/yKaTs/GOF2AAdlBdM5Y8dTotWVl5I6X1snz58tmF1Ff58L4sm1uf5O1vBfn1TUG%2bfdvNTKUnToX9TLDdakr1/OLvI6g9pqQqbj1H32FI3BwXrzearv8fpXBLFLcG8DNPbeMtdReaKIC31GqEaVXana6cuV09chjC2hh6aC47sbtAMBWeNhNESQ0BlJn0YT71AHDnxW%2bDFgNAVxYHwCkhDNk%2beOAla9TkxEdl5bV9yIH88OIJu7u7Y3K8Zy54qMdQPTY%2b6/Dng0dB0H4P0HLBnokgJkoBUIqylD7xHgV0EIvSyhNqa6kXH0Vz7Qcf8CgU4VSxc1p5v0%2bJTbF8Wmcsu/NjeYB1DRuPeTKsaZKS2Byh08HnjbXZ7bTEK/hN0AcOQiLEPKu2D0I%2b8uOBodPBtv3UXYnwsX2%2bwaMgaC2CAWyfnpexVNJ/n9W28syF20O4Kf1git7f9Z19Tz917bM8XJLsO63rpqbeBf6NAUJJRoxfrY%2brc1vEbVFYiaMT0GI3tQ9AAzB1h0mxAUorB2EAvw8%2b%2bm0oRDFgHiGgmMGRm%2bcYBNA0NFAqz5OaCL2kAVQhnpqrk%2bR0yC7ddZdQAAwHzo19bMAT%2bMSGZ2g%2bAn2XuZSuG7vj%2bhuNuguBu9E3wdTvATb7st/nLHMahXhj8moAi/bbf36WpaUll96uyLu1olT2KrL4y89Sb7afGADFUW59veRS7hXZeP8h%2bbC6sbHhyvL3srgmxWLRZY29hD%2b27rmDoBrXGmCSY9emzrh03hCIguBLhoB%2bMGHONEKOq7fyA5IokSWnBLD%2bpzCAkiOKnVG015Rb0VvbSvpdUkHQl7G8tg2velomBugZO688IJS0hP4i2aRHL2%2bT8Of6JjjPPCD0kzLLgDGePAYPtf8CL%2bcrkczavHoAAAAASUVORK5CYII=' /%3e%3c/svg%3e" width="1123" alt="Nested Tables" data-srcset="/assets/static/nested-tables.82a2fbd.ef0bd9158f1ea3144ac343f58dc0e79e.png 480w, /assets/static/nested-tables.df6d994.ef0bd9158f1ea3144ac343f58dc0e79e.png 1123w" data-sizes="(max-width: 1123px) 100vw, 1123px" data-src="/assets/static/nested-tables.df6d994.ef0bd9158f1ea3144ac343f58dc0e79e.png"><noscript><img class="g-image g-image--lazy g-image--loaded" src="/assets/static/nested-tables.df6d994.ef0bd9158f1ea3144ac343f58dc0e79e.png" width="1123" alt="Nested Tables"></noscript></p>
<p>You can see that when you roll the monster table you have a chance to get a sword, a shield, or a drop off the rare loot table with the chances being what probabilities you choose to set.</p>
<p>So, at this point you might be asking how we can implement it? Well it's actually pretty simple, so let's take it one step at a time:</p>
<ol>
<li>Copy over the properties from <code>LootItem</code>. The <code>LootTable</code> class now needs its own <code>probability</code>, <code>is_unique</code>, <code>should_drop_always</code>, and <code>is_enabled</code> properties:</li>
</ol>
<pre class="language-gdscript"><code class="language-gdscript"><span class="token comment"># The probability that this table will be hit. This is used when this table is</span>
<span class="token comment"># nested within another table.</span>
<span class="token keyword">var</span> probability<span class="token punctuation">:</span> <span class="token class-name">int</span>
<span class="token comment"># Indicates whether this table is unique or not. This is used if the table is</span>
<span class="token comment"># nested in another and if it is unique it will only be rolled once.</span>
<span class="token keyword">var</span> is_unique<span class="token punctuation">:</span> <span class="token class-name">bool</span>
<span class="token comment"># Indicates whether this table should be rolled every time or not. This is used</span>
<span class="token comment"># when the table is nested within another table.</span>
<span class="token keyword">var</span> should_drop_always<span class="token punctuation">:</span> <span class="token class-name">bool</span>
<span class="token comment"># Indicates whether this table should be rolled for drops or not. This is used</span>
<span class="token comment"># when the table is nested within another table.</span>
<span class="token keyword">var</span> is_enabled<span class="token punctuation">:</span> <span class="token class-name">bool</span></code></pre>
<ol start="2">
<li>Add the properties to the constructor like in <code>LootItem</code>:</li>
</ol>
<pre class="language-gdscript"><code class="language-gdscript"><span class="token comment"># To create a new table we need to provide it with a name. If we want to nest</span>
<span class="token comment"># this table then we'll seed to provide the probability, whether its unique,</span>
<span class="token comment"># whether it should always roll, and whether it's currently enabled or not.</span>
<span class="token comment">#</span>
<span class="token comment"># Arguments:</span>
<span class="token comment">#</span>
<span class="token comment"># `u_name` - The name of this table.</span>
<span class="token comment"># `u_probability` - The probability that this table will be hit. This is used when this table is nested within another table.</span>
<span class="token comment"># `unique` - Indicates whether this table is unique or not. This is used if the table is nested in another and if it is unique it will only be rolled once.</span>
<span class="token comment"># `always_drop` - Indicates whether this table should be rolled every time or not. This is used when the table is nested within another table.</span>
<span class="token comment"># `enabled` - Indicates whether this table should be rolled for drops or not. This is used when the table is nested within another table .</span>
<span class="token keyword">func</span> <span class="token function">_init</span><span class="token punctuation">(</span>u_name<span class="token punctuation">,</span> num_of_items<span class="token punctuation">:</span> <span class="token class-name">int</span><span class="token punctuation">,</span> u_probability<span class="token punctuation">:</span> <span class="token class-name">int</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> unique<span class="token punctuation">:</span> <span class="token class-name">bool</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> always_drop<span class="token punctuation">:</span> <span class="token class-name">bool</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> enabled<span class="token punctuation">:</span> <span class="token class-name">bool</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	name <span class="token operator">=</span> u_name
	num_of_items_to_roll <span class="token operator">=</span> num_of_items
	probability <span class="token operator">=</span> u_probability
	is_unique <span class="token operator">=</span> unique
	should_drop_always <span class="token operator">=</span> always_drop
	is_enabled <span class="token operator">=</span> enabled</code></pre>
<ol start="3">
<li>Optionally create a method that does the same thing as <code>add_item</code> but named <code>add_table</code> to be more verbose and easy to read in the code later.</li>
</ol>
<pre class="language-gdscript"><code class="language-gdscript"><span class="token comment"># Adds a table within this table. This is the same as adding an item but for</span>
<span class="token comment"># naming sake it exists as its own method.</span>
<span class="token keyword">func</span> <span class="token function">add_table</span><span class="token punctuation">(</span>table<span class="token punctuation">:</span> <span class="token class-name">LootTable</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	table_contents<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span></code></pre>
<ol start="3">
<li>Modify the <code>add_to_rolled_items</code> method to handle tables recursively by checking if the item that's rolled is a table (by having the <code>roll_table</code> method) and if so we call that table's <code>roll_table</code> method and add the rolled item/s to ours.</li>
</ol>
<pre class="language-gdscript"><code class="language-gdscript"><span class="token comment"># Since we can nest tables we need to perform some checks before we just add</span>
<span class="token comment"># items to the results.</span>
<span class="token comment">#</span>
<span class="token comment"># Arguments:</span>
<span class="token comment">#</span>
<span class="token comment"># `rolled_items` - The array to append the loot to.</span>
<span class="token comment"># `loot` - The LootItem or LootTable to check.</span>
<span class="token keyword">func</span> <span class="token function">add_to_rolled_items</span><span class="token punctuation">(</span>rolled_items<span class="token punctuation">:</span> <span class="token class-name">Array</span><span class="token punctuation">,</span> loot<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># First we only want to proceed if them is not unique or if it is unique it</span>
	<span class="token comment"># cannot exist in the unique_drops array.</span>
	<span class="token keyword">if</span> <span class="token keyword">not</span> loot<span class="token punctuation">.</span>is_unique <span class="token keyword">or</span> <span class="token keyword">not</span> unique_items<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>loot<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token comment"># If this is a new unique drop then we add it to the unique drops array.</span>
		<span class="token keyword">if</span> loot<span class="token punctuation">.</span>is_unique<span class="token punctuation">:</span> unique_items<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>loot<span class="token punctuation">)</span>
		
		<span class="token comment"># Since we could be rolling a table we want to keep the loot to add in</span>
		<span class="token comment"># an array so we can loop through and emit signals without extra work.</span>
		<span class="token keyword">var</span> items_to_add <span class="token operator">=</span> <span class="token punctuation">[</span>loot<span class="token punctuation">]</span>
		
		<span class="token comment"># If the item has a `roll_table` method then it is a LootTable and </span>
		<span class="token comment"># we need to call `roll_table` recursively and add the results to </span>
		<span class="token comment"># the array.</span>
		<span class="token keyword">if</span> loot<span class="token punctuation">.</span><span class="token function">has_method</span><span class="token punctuation">(</span><span class="token string">"roll_table"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> items_to_add <span class="token operator">=</span> loot<span class="token punctuation">.</span><span class="token function">roll_table</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		
		<span class="token comment"># For each item rolled we add it to the `rolled_items` array and emit</span>
		<span class="token comment"># the hit signal.</span>
		<span class="token keyword">for</span> loot_item <span class="token keyword">in</span> items_to_add<span class="token punctuation">:</span>
			rolled_items<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>loot_item<span class="token punctuation">)</span>
			loot<span class="token punctuation">.</span><span class="token function">emit_signal</span><span class="token punctuation">(</span><span class="token string">"hit"</span><span class="token punctuation">)</span></code></pre>
<p>That's all for nesting tables, the full <code>LootTable</code> class with nested table support can be found below:</p>
<pre class="language-gdscript"><code class="language-gdscript"><span class="token keyword">extends</span> <span class="token class-name">Resource</span>

<span class="token comment"># A LootTable defines a table that holds one or more LootItems/LootTables and it</span>
<span class="token comment"># can roll to return one or more items.</span>
<span class="token keyword">class_name</span> <span class="token class-name">LootTable</span>

<span class="token comment"># The name of this loot table.</span>
<span class="token keyword">var</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span>

<span class="token comment"># The probability that this table will be hit. This is used when this table is</span>
<span class="token comment"># nested within another table.</span>
<span class="token keyword">var</span> probability<span class="token punctuation">:</span> <span class="token class-name">int</span>
<span class="token comment"># Indicates whether this table is unique or not. This is used if the table is</span>
<span class="token comment"># nested in another and if it is unique it will only be rolled once.</span>
<span class="token keyword">var</span> is_unique<span class="token punctuation">:</span> <span class="token class-name">bool</span>
<span class="token comment"># Indicates whether this table should be rolled every time or not. This is used</span>
<span class="token comment"># when the table is nested within another table.</span>
<span class="token keyword">var</span> should_drop_always<span class="token punctuation">:</span> <span class="token class-name">bool</span>
<span class="token comment"># Indicates whether this table should be rolled for drops or not. This is used</span>
<span class="token comment"># when the table is nested within another table.</span>
<span class="token keyword">var</span> is_enabled<span class="token punctuation">:</span> <span class="token class-name">bool</span>

<span class="token comment"># Indicates the amount of items that will be rolled off this table.</span>
<span class="token keyword">var</span> num_of_items_to_roll<span class="token punctuation">:</span> <span class="token class-name">int</span>
<span class="token comment"># The LootItems in this table.</span>
<span class="token keyword">var</span> table_contents<span class="token punctuation">:</span> <span class="token class-name">Array</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token comment"># Any unique items are added here when they are hit so that they cannot drop a</span>
<span class="token comment"># second time.</span>
<span class="token keyword">var</span> unique_items<span class="token punctuation">:</span> <span class="token class-name">Array</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment"># To create a new table we need to provide it with a name. If we want to nest</span>
<span class="token comment"># this table then we'll seed to provide the probability, whether its unique,</span>
<span class="token comment"># whether it should always roll, and whether it's currently enabled or not.</span>
<span class="token comment">#</span>
<span class="token comment"># Arguments:</span>
<span class="token comment">#</span>
<span class="token comment"># `u_name` - The name of this table.</span>
<span class="token comment"># `u_probability` - The probability that this table will be hit. This is used when this table is nested within another table.</span>
<span class="token comment"># `unique` - Indicates whether this table is unique or not. This is used if the table is nested in another and if it is unique it will only be rolled once.</span>
<span class="token comment"># `always_drop` - Indicates whether this table should be rolled every time or not. This is used when the table is nested within another table.</span>
<span class="token comment"># `enabled` - Indicates whether this table should be rolled for drops or not. This is used when the table is nested within another table .</span>
<span class="token keyword">func</span> <span class="token function">_init</span><span class="token punctuation">(</span>u_name<span class="token punctuation">,</span> num_of_items<span class="token punctuation">:</span> <span class="token class-name">int</span><span class="token punctuation">,</span> u_probability<span class="token punctuation">:</span> <span class="token class-name">int</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> unique<span class="token punctuation">:</span> <span class="token class-name">bool</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> always_drop<span class="token punctuation">:</span> <span class="token class-name">bool</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> enabled<span class="token punctuation">:</span> <span class="token class-name">bool</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	name <span class="token operator">=</span> u_name
	num_of_items_to_roll <span class="token operator">=</span> num_of_items
	probability <span class="token operator">=</span> u_probability
	is_unique <span class="token operator">=</span> unique
	should_drop_always <span class="token operator">=</span> always_drop
	is_enabled <span class="token operator">=</span> enabled

<span class="token comment"># Adds an item onto this table.</span>
<span class="token comment">#</span>
<span class="token comment"># Arguments:</span>
<span class="token comment">#</span>
<span class="token comment"># `item` - The LootItem to add to this table.</span>
<span class="token keyword">func</span> <span class="token function">add_item</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> <span class="token class-name">LootItem</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	table_contents<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>

<span class="token comment"># Adds a table within this table. This is the same as adding an item but for</span>
<span class="token comment"># naming sake it exists as its own method.</span>
<span class="token keyword">func</span> <span class="token function">add_table</span><span class="token punctuation">(</span>table<span class="token punctuation">:</span> <span class="token class-name">LootTable</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	table_contents<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span>

<span class="token comment"># Rolls the table (and any nested tables) for LootItems and adds the rolled</span>
<span class="token comment"># items into the `results` array.</span>
<span class="token keyword">func</span> <span class="token function">roll_table</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># The list of items that have been rolled. We also reset the unique_drops</span>
	<span class="token comment"># array in case it was populated from previous rolls.</span>
	<span class="token keyword">var</span> rolled_items<span class="token punctuation">:</span> <span class="token class-name">Array</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	unique_items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	
	<span class="token comment"># For each table or item added we now emit the pre-roll signal.</span>
	<span class="token keyword">for</span> loot <span class="token keyword">in</span> table_contents<span class="token punctuation">:</span> loot<span class="token punctuation">.</span><span class="token function">emit_signal</span><span class="token punctuation">(</span><span class="token string">"pre_roll"</span><span class="token punctuation">)</span>
	
	<span class="token comment"># First we look for items that are always hit. These items are always</span>
	<span class="token comment"># returned and there is a chance that we can break the `count` limit if the</span>
	<span class="token comment"># number of always items is greater than the number of items to roll for.</span>
	<span class="token keyword">var</span> num_of_items_always_rolled<span class="token punctuation">:</span> <span class="token class-name">int</span> <span class="token operator">=</span> <span class="token number">0</span>
	<span class="token keyword">for</span> loot <span class="token keyword">in</span> table_contents<span class="token punctuation">:</span>
		<span class="token keyword">if</span> loot<span class="token punctuation">.</span>should_drop_always <span class="token keyword">and</span> loot<span class="token punctuation">.</span>is_enabled<span class="token punctuation">:</span>
			<span class="token function">add_to_rolled_items</span><span class="token punctuation">(</span>rolled_items<span class="token punctuation">,</span> loot<span class="token punctuation">)</span>
			num_of_items_always_rolled <span class="token operator">+=</span> <span class="token number">1</span>
	
	<span class="token comment"># Now after we got all of the always items, we have to see how many more</span>
	<span class="token comment"># items we can roll for.</span>
	<span class="token keyword">var</span> real_drop_count<span class="token punctuation">:</span> <span class="token class-name">int</span> <span class="token operator">=</span> num_of_items_to_roll <span class="token operator">-</span> num_of_items_always_rolled
	
	<span class="token comment"># Roll for more items if we still can.</span>
	<span class="token keyword">if</span> real_drop_count <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>
		<span class="token keyword">for</span> _i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span>real_drop_count<span class="token punctuation">)</span><span class="token punctuation">:</span>
			<span class="token comment"># Find the items in the table that are eligible to be rolled and</span>
			<span class="token comment"># were not rolled earlier.</span>
			<span class="token keyword">var</span> loot_that_can_be_rolled<span class="token punctuation">:</span> <span class="token class-name">Array</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
			<span class="token keyword">var</span> total_probability <span class="token operator">=</span> <span class="token number">0</span>
			<span class="token keyword">for</span> table_content <span class="token keyword">in</span> table_contents<span class="token punctuation">:</span>
				<span class="token keyword">if</span> table_content<span class="token punctuation">.</span>is_enabled <span class="token keyword">and</span> <span class="token keyword">not</span> table_content<span class="token punctuation">.</span>should_drop_always<span class="token punctuation">:</span> 
					loot_that_can_be_rolled<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>table_content<span class="token punctuation">)</span>
					total_probability <span class="token operator">+=</span> table_content<span class="token punctuation">.</span>probability
			
			<span class="token comment"># We calculate the the number that we'll compare to the probability</span>
			<span class="token comment"># of the items to decide what item is rolled by picking a random</span>
			<span class="token comment"># float from 0.0 to the total probability of all the items that can be rolled.</span>
			<span class="token keyword">var</span> hit_value<span class="token punctuation">:</span> <span class="token class-name">float</span> <span class="token operator">=</span> <span class="token function">rand_range</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> total_probability<span class="token punctuation">)</span>
			
			<span class="token comment"># Now we have to go through the list of items that can be rolled and increase</span>
			<span class="token comment"># the probability until we find an item that meets the hit_value.</span>
			<span class="token keyword">var</span> running_value<span class="token punctuation">:</span> <span class="token class-name">int</span> <span class="token operator">=</span> <span class="token number">0</span>
			<span class="token keyword">for</span> loot <span class="token keyword">in</span> loot_that_can_be_rolled<span class="token punctuation">:</span>
				running_value <span class="token operator">+=</span> loot<span class="token punctuation">.</span>probability
				<span class="token keyword">if</span> hit_value <span class="token operator">&lt;</span> running_value<span class="token punctuation">:</span>
					<span class="token function">add_to_rolled_items</span><span class="token punctuation">(</span>rolled_items<span class="token punctuation">,</span> loot<span class="token punctuation">)</span>
					<span class="token keyword">break</span>
	
	<span class="token comment"># Now for each item we rolled we dispatch the post roll signal.</span>
	<span class="token keyword">for</span> o <span class="token keyword">in</span> rolled_items<span class="token punctuation">:</span> o<span class="token punctuation">.</span><span class="token function">emit_signal</span><span class="token punctuation">(</span><span class="token string">"post_roll"</span><span class="token punctuation">)</span>
	
	<span class="token comment"># Finally we return the results of the roll.</span>
	<span class="token keyword">return</span> rolled_items

<span class="token comment"># Since we can nest tables we need to perform some checks before we just add</span>
<span class="token comment"># items to the results.</span>
<span class="token comment">#</span>
<span class="token comment"># Arguments:</span>
<span class="token comment">#</span>
<span class="token comment"># `rolled_items` - The array to append the loot to.</span>
<span class="token comment"># `loot` - The LootItem or LootTable to check.</span>
<span class="token keyword">func</span> <span class="token function">add_to_rolled_items</span><span class="token punctuation">(</span>rolled_items<span class="token punctuation">:</span> <span class="token class-name">Array</span><span class="token punctuation">,</span> loot<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># First we only want to proceed if them is not unique or if it is unique it</span>
	<span class="token comment"># cannot exist in the unique_drops array.</span>
	<span class="token keyword">if</span> <span class="token keyword">not</span> loot<span class="token punctuation">.</span>is_unique <span class="token keyword">or</span> <span class="token keyword">not</span> unique_items<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>loot<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token comment"># If this is a new unique drop then we add it to the unique drops array.</span>
		<span class="token keyword">if</span> loot<span class="token punctuation">.</span>is_unique<span class="token punctuation">:</span> unique_items<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>loot<span class="token punctuation">)</span>
		
		<span class="token comment"># Since we could be rolling a table we want to keep the loot to add in</span>
		<span class="token comment"># an array so we can loop through and emit signals without extra work.</span>
		<span class="token keyword">var</span> items_to_add <span class="token operator">=</span> <span class="token punctuation">[</span>loot<span class="token punctuation">]</span>
		
		<span class="token comment"># If the item has a `roll_table` method then it is a LootTable and </span>
		<span class="token comment"># we need to call `roll_table` recursively and add the results to </span>
		<span class="token comment"># the array.</span>
		<span class="token keyword">if</span> loot<span class="token punctuation">.</span><span class="token function">has_method</span><span class="token punctuation">(</span><span class="token string">"roll_table"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> items_to_add <span class="token operator">=</span> loot<span class="token punctuation">.</span><span class="token function">roll_table</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		
		<span class="token comment"># For each item rolled we add it to the `rolled_items` array and emit</span>
		<span class="token comment"># the hit signal.</span>
		<span class="token keyword">for</span> loot_item <span class="token keyword">in</span> items_to_add<span class="token punctuation">:</span>
			rolled_items<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>loot_item<span class="token punctuation">)</span>
			loot<span class="token punctuation">.</span><span class="token function">emit_signal</span><span class="token punctuation">(</span><span class="token string">"hit"</span><span class="token punctuation">)</span></code></pre>
<p>Now let's modify our <code>main.gd</code> so we can test this out:</p>
<ol>
<li>Let's start out by creating a couple <code>LootTables</code> that will be nested in our Boss table. We'll give the Common table a 3x greater chance to be hit than the Rare drop table.</li>
</ol>
<pre class="language-gdscript"><code class="language-gdscript">	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token comment"># Create our nested tables and add them to the Boss table.</span>
	<span class="token keyword">var</span> common_drop_table<span class="token punctuation">:</span> <span class="token class-name">LootTable</span> <span class="token operator">=</span> LootTable<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Common"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
	<span class="token keyword">var</span> rare_drop_table<span class="token punctuation">:</span> <span class="token class-name">LootTable</span> <span class="token operator">=</span> LootTable<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Rare"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
	
	boss_loot_table<span class="token punctuation">.</span><span class="token function">add_table</span><span class="token punctuation">(</span>common_drop_table<span class="token punctuation">)</span>
	boss_loot_table<span class="token punctuation">.</span><span class="token function">add_table</span><span class="token punctuation">(</span>rare_drop_table<span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre>
<ol start="2">
<li>Instead of adding the items directly to the Boss table, let's split them up onto the two sub-tables.</li>
</ol>
<pre class="language-gdscript"><code class="language-gdscript">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	common_drop_table<span class="token punctuation">.</span><span class="token function">add_item</span><span class="token punctuation">(</span>sword_loot_item<span class="token punctuation">)</span>
	common_drop_table<span class="token punctuation">.</span><span class="token function">add_item</span><span class="token punctuation">(</span>shield_loot_item<span class="token punctuation">)</span>
	common_drop_table<span class="token punctuation">.</span><span class="token function">add_item</span><span class="token punctuation">(</span>bow_loot_item<span class="token punctuation">)</span>
	rare_drop_table<span class="token punctuation">.</span><span class="token function">add_item</span><span class="token punctuation">(</span>staff_loot_item<span class="token punctuation">)</span>
	rare_drop_table<span class="token punctuation">.</span><span class="token function">add_item</span><span class="token punctuation">(</span>helmet_loot_item<span class="token punctuation">)</span>
	rare_drop_table<span class="token punctuation">.</span><span class="token function">add_item</span><span class="token punctuation">(</span>platebody_loot_item<span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre>
<ol start="3">
<li>Now we press play and see the results of the roll! In my demo I set the Boss table to drop 2 items and my 2 ended up being:</li>
</ol>
<ul>
<li>Staff</li>
<li>
<p>Bow</p>
<p>Now this time we actually hit the rare drop table, but in another roll I got:</p>
</li>
<li>Bow</li>
<li>
<p>Sword</p>
<p>So that time I hit the common table for both items.</p>
</li>
</ul>
<h2 id="bonus"><a href="#bonus" aria-hidden="true"><span class="icon icon-link"></span></a>Bonus!</h2>
<p>In the article that gave me the inspiration for this, the author implements events for the loot items and table and I figured it may be useful to someone so here's a bonus section for it. So an event based system in Godot would involve signals and we're going to create a custom signal that will get emitted when an item on the drop table is it or even when a table within a table is hit. One example of when this could be useful is in a multiplayer game if you want to notify every player when someone gets a super rare drop.</p>
<p>So this is actually pretty easy. To do this, open up your <code>loot_item</code> class and add the <code>hit</code> signal below the variables.</p>
<pre class="language-gdscript"><code class="language-gdscript"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">var</span> is_enabled<span class="token punctuation">:</span> <span class="token class-name">bool</span>

<span class="token comment"># The signal that gets emitted when this item is hit on the drop table.</span>
<span class="token keyword">signal</span> hit
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre>
<p>Now in the <code>loot_table</code> class, we want to go down to our <code>add_to_rolled_items</code> method and right below where we append the the item to the <code>rolled_items</code> array and emit the signal like so:</p>
<pre class="language-gdscript"><code class="language-gdscript"><span class="token comment"># For each item rolled we add it to the `rolled_items` array and emit</span>
<span class="token comment"># the hit signal.</span>
<span class="token keyword">for</span> loot_item <span class="token keyword">in</span> items_to_add<span class="token punctuation">:</span>
	rolled_items<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>loot_item<span class="token punctuation">)</span>
	loot<span class="token punctuation">.</span><span class="token function">emit_signal</span><span class="token punctuation">(</span><span class="token string">"hit"</span><span class="token punctuation">)</span></code></pre>
<p>Finally, head over to the <code>main.gd</code> file we created to test our loot system and add a signal to one of the items (I picked the shield) like so:</p>
<pre class="language-gdscript"><code class="language-gdscript"><span class="token keyword">var</span> shield<span class="token punctuation">:</span> <span class="token class-name">Dictionary</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Shield"</span><span class="token punctuation">,</span>
	<span class="token string">"attack"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token string">"defence"</span><span class="token punctuation">:</span> <span class="token number">5</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> shield_loot_item<span class="token punctuation">:</span> <span class="token class-name">LootItem</span> <span class="token operator">=</span> LootItem<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>shield<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>

<span class="token comment"># Connect the shield's hit signal to a function named "_on_shield_rolled".</span>
shield_loot_item<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"hit"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token string">"_on_shield_rolled"</span><span class="token punctuation">)</span>

<span class="token comment"># This function is going to print to the console when we roll the shield.</span>
<span class="token keyword">func</span> <span class="token function">_on_shield_rolled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"We rolled a shield!"</span><span class="token punctuation">)</span></code></pre>
<p>Just make sure you have a function in the <code>main.gd</code> file that you can attach the function to as shown above whenever you roll the shield you should see that message print to the console.</p>
<p>Of course this means that if you have nested tables then the signal will be emitted twice because the sub table will roll it and then the main table also will so the signal gets emitted twice so you can change the <code>emit_signal</code> to also include the table object like so:</p>
<pre class="language-gdscript"><code class="language-gdscript"><span class="token comment"># For each item rolled we add it to the `rolled_items` array and emit</span>
<span class="token comment"># the hit signal.</span>
<span class="token keyword">for</span> loot_item <span class="token keyword">in</span> items_to_add<span class="token punctuation">:</span>
	rolled_items<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>loot_item<span class="token punctuation">)</span>
	loot<span class="token punctuation">.</span><span class="token function">emit_signal</span><span class="token punctuation">(</span><span class="token string">"hit"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">)</span></code></pre>
<p>Then, in your <code>_on_shield_rolled</code> function you can check to see if the main boss table rolled it like so:</p>
<pre class="language-gdscript"><code class="language-gdscript"><span class="token comment"># This function is going to print to the console when we roll the shield.</span>
<span class="token keyword">func</span> <span class="token function">_on_shield_rolled</span><span class="token punctuation">(</span>table<span class="token punctuation">:</span> <span class="token class-name">LootTable</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span> table<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">"Boss"</span><span class="token punctuation">:</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"We rolled a shield!"</span><span class="token punctuation">)</span></code></pre>
<p>There's other ways this could be handled but I'll leave that as a challenge to you, the above gets you 95% of the way there.</p>
<h2 id="conclusion"><a href="#conclusion" aria-hidden="true"><span class="icon icon-link"></span></a>Conclusion</h2>
<p> Now that you have the basic workings of a loot system, the challenge for you is to figure out how to best implement it in your game. You could for example not provide any item definitions when creating items but instead just provide an id of an item that links to an id of a resource somewhere else like a database. Also since the loot items and tables are resources you could make your items into resources in Godot (sword.tres, shield.tres, etc) and on another class you could ask for an export of items/tables so you don't have to do it by code. I might expand on these concepts in a later tutorial but for now let me know if you have any questions and I'll gladly answer them!</p>
</div><div class="post__footer"><div class="post-tags"><a href="/tag/godot/" class="post-tags__link">godot</a><a href="/tag/unity/" class="post-tags__link">unity</a><a href="/tag/loot/" class="post-tags__link">loot</a><a href="/tag/game-development/" class="post-tags__link">game-development</a></div></div><div class="author post__author"><img alt="Author image" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 328 328' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-01a977fbf7b567b5530e68a6b3d8c4c9'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-01a977fbf7b567b5530e68a6b3d8c4c9)' width='328' height='328' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCABAAEADASIAAhEBAxEB/8QAGwAAAwADAQEAAAAAAAAAAAAABQYHAwQIAgH/xAAzEAACAQMDAQUGBgIDAAAAAAABAgMEBREAEiEGBxMxQVEiMmFxgaEUFSRCkbEWF1Jy0f/EABoBAAIDAQEAAAAAAAAAAAAAAAMFAQIEBgD/xAAjEQACAQUAAQQDAAAAAAAAAAABAgADBBESITEFIkFRMmFx/9oADAMBAAIRAxEAPwA9cIAwPGkLqy4wWOneokY7z7KRr4s3lqkVmApLHAAySfIahN6qpes%2bpJoYsiipmCRJ5nnBPzP9aXW9Mu36mhjiA67rO8zNuScQIPAIcZ%2bemHpbq%2btqahY5XeoIGe728sPnonRdlhkG%2bsnjiQ%2bCp7TaYKXpOisqI1NE25f3n3mPx0wqUBryQjHPYWslTBdDLHEWSeE4kiYjcujUdrJ8zpY63qloLnZurLbFtq639BXQpwjSqAVfHhkrx9M6odslFVRQTlAhkQMVznaSPDOsTe2XIggWfIzgn66%2b/k4/4N99TvtJ6sq7J1PW08QWSAKhy7SewSPABWA%2bOkqp60rZYnkUR4Xg4aUf2%2bpFJmGRIyo4TL5dwWoqhVbYTG2G9OPHUH7LKpafqqoQ4aGYNyT4YOc6vFzy9NMqDLFCACcZONR609IzWW6w1k7hpEqoldR7ojc4LfycfXRbAjYgylT7lETqBJJAtJRPON20SMwRP5Pj8hohf5Vp7GZ49kcznbge0E9Do7VdK22odKqopBM6Y7pS3Ef/AFHloddKFmJpFh3gKGZR5D0z8tOGQBeQaZY9kshsV0vUdXDEa4yzAsnfSAIxXlSFxx8PMaovZkaxelojcEZJjI5w3z5%2b%2bdeaKj7iXEcxPdngZ5A8s%2bh0fpNkMAWMYUkt9SST9zpTeAcI%2bYdeDEjHaDVU3%2bb3iOaquMbxkSNHSsANoRcHnz50p1kVJWIqw1dwnxLt2zcgEcnPPpon2gSP/sLqRkJw0XdHHkCE51p9Po0aTtK6lu9iYKPINlSdeRQqbSrElsS91UmAdJd8v9NbL7RiaLv8KWli2g95EeCpz6n%2btNNZIApycD11z/1Tfqi5XiWo2LGvMUPHOzdwT8dZLVHd9k%2bJZio/KdQ9A9TUd7twMZIaMlCjkFlHln6Y51iu0tZLVyzQRmGFSRvbgEaivYhRXK49UyRvLURU5gbMyN7j/tOPPJBH86rs0vUtCssFVQyVOw47yFS6sP7Guip76jbzMpYA88QAtL%2bGnasErGLJbhs7vXR%2bjlP4aPd4lQT9dA6ikrrjUhpaeSlpoxl93sk/ADStYr/eLVevynqfawbmKryArA%2b6c8DHl8Dpbf0mbGIZGBgnqCwS3bqW/VERQFqsR5J5wEXI%2bXhpPq6Wqs9z7tvGRlRiQTuUEeH8afhfaCmvd4inq4o5Gq2cBmxkbV5z4aEdUV9BXT0MUNRFLL36g7GyQDpalWopII5DMAY09QdU0EcM0MDtNKyMgKDgEgjOTqW9ygKDaGZRjJ50VenwSx5J15WAA5xjnOuys/TKdoCF7n7iSrdmp5lI7DrlR0N0mo6oiMzsGSQ%2bo8vvroOWJChYcEj3h56473tBKslOdrgg8HH1HodPll7VrxQUqU8%2bJ1TgF%2bDola3bbZZFOsCMGV%2b5W8AMijCP5nUI7WJ4vzGno4WDPAmXIPgSeB9tGr72t3a50ppqeCGDjHeDlv8AzU3qQ1RI8tQ5aRiSSTkk6qlsSdmGJdq4AwDNaUQA/qIllBHssfeH11kpKSmlnikgYq0bh9pPjjWvOAxIGePDOsSIy8gkHOdAufTUrA/B%2b4Wjdmn/ACf/2Q==' /%3e%3c/svg%3e" width="328" data-src="/assets/static/author.de4034a.47c56ffa8bb5f81a48029e779b4a2893.jpg" data-srcset="/assets/static/author.de4034a.47c56ffa8bb5f81a48029e779b4a2893.jpg 328w" data-sizes="(max-width: 328px) 100vw, 328px" class="author__image g-image g-image--lazy g-image--loading"><noscript><img src="/assets/static/author.de4034a.47c56ffa8bb5f81a48029e779b4a2893.jpg" class="author__image g-image g-image--loaded" width="328" alt="Author image"></noscript><div class="author__bio"><p class="author__name">Robert Corponoi</p><p class="author__intro">Self proclaimed JavaScript wizard</p></div><a href="https://twitter.com/robertcorponoi" target="_blank" rel="noreferrer" class="btn btn--secondary">Follow</a></div></div></main><footer class="footer"><div class="container"><ul class="soc"><li><a href="https://twitter.com/robertcorponoi" target="_blank" rel="noreferrer" title="Twitter" class="soc__icon soc__icon--twitter"><div class="soc__ir"><svg viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M419.6 168.6c-11.7 5.2-24.2 8.7-37.4 10.2 13.4-8.1 23.8-20.8 28.6-36 -12.6 7.5-26.5 12.9-41.3 15.8 -11.9-12.6-28.8-20.6-47.5-20.6 -42 0-72.9 39.2-63.4 79.9 -54.1-2.7-102.1-28.6-134.2-68 -17 29.2-8.8 67.5 20.1 86.9 -10.7-0.3-20.7-3.3-29.5-8.1 -0.7 30.2 20.9 58.4 52.2 64.6 -9.2 2.5-19.2 3.1-29.4 1.1 8.3 25.9 32.3 44.7 60.8 45.2 -27.4 21.4-61.8 31-96.4 27 28.8 18.5 63 29.2 99.8 29.2 120.8 0 189.1-102.1 185-193.6C399.9 193.1 410.9 181.7 419.6 168.6z"></path></svg></div></a></li><li><a href="https://github.com/robertcorponoi" target="_blank" rel="noreferrer" title="GitHub" class="soc__icon soc__icon--github"><div class="soc__ir"><svg viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M256 70.7c-102.6 0-185.9 83.2-185.9 185.9 0 82.1 53.3 151.8 127.1 176.4 9.3 1.7 12.3-4 12.3-8.9V389.4c-51.7 11.3-62.5-21.9-62.5-21.9 -8.4-21.5-20.6-27.2-20.6-27.2 -16.9-11.5 1.3-11.3 1.3-11.3 18.7 1.3 28.5 19.2 28.5 19.2 16.6 28.4 43.5 20.2 54.1 15.4 1.7-12 6.5-20.2 11.8-24.9 -41.3-4.7-84.7-20.6-84.7-91.9 0-20.3 7.3-36.9 19.2-49.9 -1.9-4.7-8.3-23.6 1.8-49.2 0 0 15.6-5 51.1 19.1 14.8-4.1 30.7-6.2 46.5-6.3 15.8 0.1 31.7 2.1 46.6 6.3 35.5-24 51.1-19.1 51.1-19.1 10.1 25.6 3.8 44.5 1.8 49.2 11.9 13 19.1 29.6 19.1 49.9 0 71.4-43.5 87.1-84.9 91.7 6.7 5.8 12.8 17.1 12.8 34.4 0 24.9 0 44.9 0 51 0 4.9 3 10.7 12.4 8.9 73.8-24.6 127-94.3 127-176.4C441.9 153.9 358.6 70.7 256 70.7z"></path></svg></div></a></li><li><a href="https://www.linkedin.com/in/robert-corponoi-1353a1112/" target="_blank" rel="noreferrer" title="LinkedIn" class="soc__icon soc__icon--linkedin"><div class="soc__ir"><svg viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M186.4 142.4c0 19-15.3 34.5-34.2 34.5 -18.9 0-34.2-15.4-34.2-34.5 0-19 15.3-34.5 34.2-34.5C171.1 107.9 186.4 123.4 186.4 142.4zM181.4 201.3h-57.8V388.1h57.8V201.3zM273.8 201.3h-55.4V388.1h55.4c0 0 0-69.3 0-98 0-26.3 12.1-41.9 35.2-41.9 21.3 0 31.5 15 31.5 41.9 0 26.9 0 98 0 98h57.5c0 0 0-68.2 0-118.3 0-50-28.3-74.2-68-74.2 -39.6 0-56.3 30.9-56.3 30.9v-25.2H273.8z"></path></svg></div></a></li></ul><span class="footer__copyright">Copyright © 2021 Robert Corponoi</span><a href="https://opensource.org/licenses/MIT" target="_blank" rel="noreferrer" class="footer__license">All Code MIT Licensed</a></div></footer></div>
  <script src="/assets/js/app.1b9cc82c.js" defer></script><script src="/assets/js/page--src-templates-post-vue.ed68cdd5.js" defer></script>
</body>

</html>