{"hash":"85a87da2caa6a3c8ae7647f17d7dfc4c0f704337","data":{"tag":{"title":"unity","belongsTo":{"edges":[{"node":{"title":"Creating a Loot System","path":"/creating-a-loot-system/","date":"24. July 2020","timeToRead":23,"description":"Learn how to easily create a loot system for enemies and chests.","cover_image":{"type":"image","mimeType":"image/png","src":"/assets/static/chest.c521340.dec358a6bf7cb7fed011d4e39cb34716.png","size":{"width":850,"height":604},"sizes":"(max-width: 850px) 100vw, 850px","srcset":["/assets/static/chest.a67b0b2.dec358a6bf7cb7fed011d4e39cb34716.png 480w","/assets/static/chest.c521340.dec358a6bf7cb7fed011d4e39cb34716.png 850w"],"dataUri":"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 850 604' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-40af2268e2dfe4871592795e26ffcc9d'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='10'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-40af2268e2dfe4871592795e26ffcc9d)' width='850' height='604' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAtCAYAAAAeA21aAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAJaElEQVRo3u2X%2bVMVVxbH%2b3/JhH15G29hExUQtyDiHmURgQfIFozLjGilBjURoqKSMZXJ1ERTxgVxi4JixklMohNnfpjRGsQddSTqVCaymKmo%2bc45t2%2b/1930AzUVmSr94VP33HNvn3O%2bp7vv66fsvdAHA133saerT6K3CVrfLbg/lC4juwx8b2B3Vz8%2b6foXcVvY5vVdpusNsS%2bEQq3PUK%2bsf2%2bXSSPRKlH2dd9Ha3fQoRHcfD%2bAGtDUlCHN6RumSI0BIV40gOyR9/eFEGgUyzcvWK9RaIBuFda9j/YpbTRp44mZC9wYgscnaI5guAYZ7soA3dnbRK%2bwn%2bQaozij0FZLVA1mXW0B%2bgTK/ot92N8dpG0IFs2RqM2xblKr%2bdXSFd0q7vptuqO9wjYLCnn3pDA9VnXpBWroNQrNxAFCOXixHxoHDMiN3SM1SGXfMI3SP1UqLPo20SvsoH/kGG3D1BBKpF6XXu8hbsDhS33QOKSHFg8KQjVI1ySLRg33RO3vHqDXq1fAdlsIYZYxQwgzi9MEHjLpCurtFyhHLvdDz6eXjBwOELpRVs0yc4CKF4h9g2i72Et8K2whxrAeOo6WbyRhZh1mnUclSseVAWi0C/rRflnlqIkhzbJo2NDGcdH3cYRjX3sg7MPijt0WsH2o%2b3uKN4CjVx/QvE9Fd32oHEcuhxamoWlpl/o6TCidVwegcdzEMeZKkA4L2vVctm5e542H2PP3O/jozHV0XP8vjvc8RnvPd8R/cKznETpvPkTruX9jxzc30H71B3Rc%2b2GoACEitJCOK8ZaBRaaOk0of7o2CD2fWXDi2gBOXDXSacFxqyZS0R8easeKDw%2bitnkHNu/Yjq2f7MHmnWTv/Bhbdu7Ce7t2Y3XL%2b6h67wCaPt6L/X%2b9hBM91Ci6diQBnaa6RK2EWYNZ50nm%2biCUL3oeIMggPmeuG/mzBSfNyKDBJAM42UN388Jd1K9ZgaqNH6GuqQUrVi7GsvoaLJeodhWWv7UM1S2tqF5dj9%2b3HcCpXuCzq/3Ggq8NzWtV2%2bcWsDaVoN5ThPL1zQcQ3DDyVQi%2b1NNj5JSOLyjpV7d%2bxLHzt7C0vg7ljX9AZUMTlv2mSsyX1r8hUe0lK2lP0x9RUb8aLTt24My3P1GMAYo1aIhrzqnVEqrer60gvaclytlbD6Dnm2H4y80n58yNQZztfYgT52%2biss6PkjXbULaqAdV1JahaUo6qulKJH9VLyshXgZJ1H6Bo6a%2bx6YP38bc7P%2bH0jQGceYqcos6b1rWfDYFy/t5jnL/3CGK8%2byho83g3aJ%2b7q9tzV87laMU/7jzEP78DTl%2b%2bh/IaP%2ba9sRr5NUtQUrYAJRVF8NdUwF9bgdJqak55AYrLF2L%2bm7/FvFI/frd9O%2bjTgGL8aIip1XEuUKe%2bxscW9er26NYC%2bwnl7Q1b8M7GLeCxcVOLtDeL%2bXqai3Vpr2tqFmvr3pWjnL/9rrQDY7MY16zfiLWNzah9sxZFpfNRXFYgGrCoshx5KzdhQX0z8pc3kD9frC3y5wt7dcM6rOXrGzeKGGIkGtZvIP8mYa9t3CTgPFouzt/wzgZR33qphWlsbsGGLdvI3kr%2brWLUUGbPmom5c2ZjZu50zJ45QzBrxgzMoPnMGblyJB/5p%2bdMQ25OjvDnTMumeQ5yp%2bcIH895L%2b9R13ichuypryG/8HX4KxeitKIQpeUksnoxFqzaQrSgYPka8hWoa5LcXIqXnS2un5atxuI8HJdzcR5eY5/ISbZWL69z/axL882ZPUvVRcybO0fYvMZzZdLkKdDImjgJEydNpnEyjVOQMWEiMjWyJol5emaWGDMyVTudxvEZWRiXPgFjx2cG4Dn708ZlYNbcmSirLKJHvVCILVlcJJqwiCiu9JOvkF4LVTzvyaQ6tBiBmOnqOD5DjcujyJ%2bhkiFqUWtLpzWul3Vw7ROkzZo0H4%2bTp0yFkpQyFt6kMfAlp8GXkgYvjTz3JqXBI/2a7U5MFTaPCb5UuLwpcHqSVchmn1iT6%2byLd/owJWcqNYDEleWRwHwiD6Vl8yULpC9fPB2LSheIXHZ3koghsMjn8mn5xgRq4lHUHtCg2j6JpicpdSySx4wTKBzMIQU4PSlBWybjQmwJKvGuRMS5fIhzqvDcRut2txqD7TjyxdIaw3ZUvBsT6bEsrS1HUWUpvf/%2bkBRX%2bVFQVgwH5Y5xeA1xOL9d1KPWJGpxBmtR98h9tK7X4XCrNjfQod0w1k1%2bhS%2bMl0Vz0mjG7kGUHpsHkTZ1jLZ7ESMTxhJs855IscctR7mf9oZF25E%2buxgFb23D/JXNdPBttmblZuSt2op5y5sQ50lFRFyCLq4W2y18MQ6fyK01m2vW9kbZTLUTvM7atLo1zfHULIXvUCQRZUGkbi2GxMRyYoJtsU5FcqE8ansjtTkLoPmrUQ5kZOeiuG4JCquqsbC6JiRFNbXIr6ikApMQHusyxQvGj9DFjybBsQ61NnEDuQGilgRLXXpNvFfxxnvBeASeAF6bF4n2RCQ6EuElEu0%2bsccd51ER%2b7zDQzFc0QmYOjELi6sL4a/IQ1lFvo48g12%2bmH4hSl5HojNJ5BgxfrwnUA/PfVQjk%2bRQ6/bZgjUHdEm9mmYljDqpEc7d4ceGHymCbfYZ9%2biIGwF%2bAuhOOujAGpdFvwiZE5A2geCTfDKd6NmvCVv4aG0sjSnjMxBhcwdzjZhDxVxjhHwFNS0812vRrlXE4yDfqxjtXSKfloAftwiaB4hzG%2bfDIa8Noya8Eu3ErySvRDoR4bQjIjFN2AG/HAM5nyaXqcZA/fHquSTOLnkW8DkRITUq2gESoRMdbhJtnj8N5mv5IAunAmM9LsSmjqN3XfWNdN2z5jM/MeoN9wYOfCWU6J8rPDQJQnQMNSCGvkHCY3%2bJHE/WDPYpz0f06DRgJF3iFXg%2boodrgPs55h7aEOX5J9c3gM6AmATDgfm8Gb0GuB2ISR5DP0WJJN41KuJHsQH0s5tgR0xSKsJtKaPbgBE/NH4BwugJiKYGRCelIMyWTD4nRqMOcQjq/7w8KdqHU7T25%2bkpUD%2b2fLB5XYinv6VRrjT6b8F/WJ4t3s9F4S%2bkp0L34fQsqB9C9AeGzoDYZHoF7Cn0cfIivQLx6iugnQFhdAaE0xkQHucenVdg1H4F/l8OwVFtAL8CdAi%2bmA3g7wCfD%2bGOsS9qA5z0NUi2K/0Fb4Az/eUT8LIBLxvwsgEvGzBaDfgf0OTBFGlzKt4AAAAASUVORK5CYII=' /%3e%3c/svg%3e"},"content":"<h2 id=\"getting-started\"><a href=\"#getting-started\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Getting Started</h2>\n<p>If you're making a game that involves the player killing and looting enemies or looting chests then you're probably wondering of a good way to create a loot system for it. There's a couple approaches to this. You could of course just have an array of items that the enemy or chest drops but the problem with that everything has the same weight. Imagine that you wanted a monster to drop some coins and maybe a piece of armor but there's varying levels of armor. You want the boss to drop a low level piece of armor most of the time you want to give the player something to work towards if they want to so ever so often you want a monster to drop a higher level piece of armor. In order to accomplish this you'll need to create a loot table with weighted options but it's actually easier than it looks and it can be done in two parts. The completed project can be found on my GitHub at <a href=\"https://github.com/robertcorponoi/godot-loot-system\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">robertcorponoi/godot-loot-system</a>. Also this article was inspired by <a href=\"https://www.codeproject.com/Articles/420046/Loot-Tables-Random-Maps-and-Monsters-Part-I\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this</a> so check it out to see a slightly different approach (in C#).</p>\n<p><strong>Note:</strong> While this article covers how to do it in Godot, this can be easily ported to any other engine as its just 2 simple classes.</p>\n<h2 id=\"part-1---the-items\"><a href=\"#part-1---the-items\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Part 1 - The Items</h2>\n<p>The first things we need to do is create the class for the items that go in the loot tables. For this, we need to decide what basic properties all of our items will need and it can be boiled down to the following:</p>\n<ul>\n<li><strong>probability</strong>: The single most important part of our item is the probability. This is just a number, any number you wish. A probability of 1 is very low and chances are the item won't be rolled often while a probability of 100 me\nans that item will probably be rolled more often. An important thing to note is that this is not a percentage so don't think of it that way. Probability can be 5 or 4500, it's all relative to the probabilities of the other items on the loot table.</li>\n<li><strong>is_unique</strong>: This is used to indicates whether an item is unique or not. If an item is unique then it cannot be rolled twice. For example, if you have a piece of rare armor on your drop table you don't want it to be able to be rolled twice while on the other hand you might a drop of leather boots to drop more than once.</li>\n<li><strong>always_drop</strong>: This indicates whether the item should always be rolled. For example, your monster might drop bones and that would be a drop that always happens.</li>\n<li><strong>is_enabled</strong>: This indicates whether the item is currently able to be rolled or not. This enables you to enable/disable drops whenever you wish.</li>\n<li><strong>item</strong>: The data of the item to put on the loot table. Since there's so many ways to represent the data in your game it all gets set in this property in any way you wish. I personally prefer using a dictionary with the name and stats of the item but you could also just change <code>item</code> to <code>id</code> and use and id that you can check against a database when it's rolled.</li>\n</ul>\n<p>Now that we have our item's properties, let's put them in a <code>LootItem</code> class in a new script named <code>loot_item.gd</code>:</p>\n<pre class=\"language-gdscript\"><code class=\"language-gdscript\"><span class=\"token keyword\">extends</span> <span class=\"token class-name\">Resource</span>\n\n<span class=\"token comment\"># A LootItem defines an item that goes on a DropTable and it contains an item's</span>\n<span class=\"token comment\"># properties and it's chance of being hit along with other variables that define</span>\n<span class=\"token comment\"># how often it gets hit.</span>\n<span class=\"token keyword\">class_name</span> <span class=\"token class-name\">LootItem</span>\n\n<span class=\"token comment\"># The data that represents the properties of this item.</span>\n<span class=\"token keyword\">var</span> item\n<span class=\"token comment\"># The probability that this item will be selected.</span>\n<span class=\"token keyword\">var</span> probability<span class=\"token punctuation\">:</span> <span class=\"token class-name\">int</span>\n<span class=\"token comment\"># Indicates whether this item is unique or not. A unique item will only drop</span>\n<span class=\"token comment\"># once per roll.</span>\n<span class=\"token keyword\">var</span> is_unique<span class=\"token punctuation\">:</span> <span class=\"token class-name\">bool</span>\n<span class=\"token comment\"># Indicates whether this item should drop every time or not.</span>\n<span class=\"token keyword\">var</span> should_drop_always<span class=\"token punctuation\">:</span> <span class=\"token class-name\">bool</span>\n<span class=\"token comment\"># Indicates whether this item is eligible to be rolled or not.</span>\n<span class=\"token keyword\">var</span> is_enabled<span class=\"token punctuation\">:</span> <span class=\"token class-name\">bool</span>\n\n<span class=\"token comment\"># To create a LootItem we need the item's data, its probability, whether it's</span>\n<span class=\"token comment\"># unique or not, if it should always be rolled, and whether it's currently</span>\n<span class=\"token comment\"># enabled or not.</span>\n<span class=\"token comment\">#</span>\n<span class=\"token comment\"># Arguments:</span>\n<span class=\"token comment\">#</span>\n<span class=\"token comment\"># `u_item` - The data that represents the properties of this item.</span>\n<span class=\"token comment\"># `u_probability` - The probability that this item will be selected.</span>\n<span class=\"token comment\"># `unique` - Indicates whether this item is unique or not. A unique item will only drop once per roll.</span>\n<span class=\"token comment\"># `always` - Indicates whether this item should drop every time or not.</span>\n<span class=\"token comment\"># `enabled` - Indicates whether this item is eligible to be rolled or not.</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">_init</span><span class=\"token punctuation\">(</span>u_item<span class=\"token punctuation\">,</span> u_probability<span class=\"token punctuation\">:</span> <span class=\"token class-name\">int</span><span class=\"token punctuation\">,</span> unique<span class=\"token punctuation\">:</span> <span class=\"token class-name\">bool</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> always_drop<span class=\"token punctuation\">:</span> <span class=\"token class-name\">bool</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> enabled<span class=\"token punctuation\">:</span> <span class=\"token class-name\">bool</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\titem <span class=\"token operator\">=</span> u_item\n\tprobability <span class=\"token operator\">=</span> u_probability\n\tis_unique <span class=\"token operator\">=</span> unique\n\tshould_drop_always <span class=\"token operator\">=</span> always_drop\n\tis_enabled <span class=\"token operator\">=</span> enabled</code></pre>\n<p>Just like that, the first part is done. Notice how there's nothing fancy in the <code>LootItem</code> class, it's just a collection of properties that the loot table will use to decide if this item is rolled or not.</p>\n<h2 id=\"part-2---the-table\"><a href=\"#part-2---the-table\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Part 2 - The Table</h2>\n<p>The loot table is what's going to be rolled and will decide which items should be rolled. Let's see what properties we'll need out of our loot tables:</p>\n<ul>\n<li><strong>name</strong>: While this isn't necessary it's nice to give some context to our table (kind of like the item is defined by its item property).</li>\n<li><strong>num_of_items_to_roll</strong>: This is the most important part of the table, this lets the table know how many items that it should roll for.</li>\n<li><strong>table_contents</strong>: This is where all of the items in the table are stored.</li>\n<li><strong>unique_drops</strong>: We need to keep track of which unique drops have been rolled because we do not want a unique drop to be rolled twice.</li>\n</ul>\n<p>Alright that's all of the basic properties of the table to let's set up the basic properties and constructor in a class named <code>LootTable</code> in a file named <code>loot_table.gd</code>:</p>\n<pre class=\"language-gdscript\"><code class=\"language-gdscript\"><span class=\"token keyword\">extends</span> <span class=\"token class-name\">Resource</span>\n\n<span class=\"token comment\"># A LootTable defines a table that holds one or more LootItems and it</span>\n<span class=\"token comment\"># can roll to return one or more items.</span>\n<span class=\"token keyword\">class_name</span> <span class=\"token class-name\">LootTable</span>\n\n<span class=\"token comment\"># The name of this loot table.</span>\n<span class=\"token keyword\">var</span> name<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span>\n<span class=\"token comment\"># Indicates the amount of items that will be rolled off this table.</span>\n<span class=\"token keyword\">var</span> num_of_items_to_roll<span class=\"token punctuation\">:</span> <span class=\"token class-name\">int</span>\n<span class=\"token comment\"># The LootItems in this table.</span>\n<span class=\"token keyword\">var</span> table_contents<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Array</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token comment\"># Any unique drops are added here when they are hit so that they cannot drop a</span>\n<span class=\"token comment\"># second time.</span>\n<span class=\"token keyword\">var</span> unique_drops<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Array</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\"># To create a new table we need to provide it with a name and specify the amount</span>\n<span class=\"token comment\"># of items within it.</span>\n<span class=\"token comment\">#</span>\n<span class=\"token comment\"># Arguments:</span>\n<span class=\"token comment\">#</span>\n<span class=\"token comment\"># `u_name` - The name of this table.</span>\n<span class=\"token comment\"># `num_items` - The amount of items that this table should roll for.</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">_init</span><span class=\"token punctuation\">(</span>u_name<span class=\"token punctuation\">,</span> num_of_items<span class=\"token punctuation\">:</span> <span class=\"token class-name\">int</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\tname <span class=\"token operator\">=</span> u_name\n\tnum_of_items_to_roll <span class=\"token operator\">=</span> num_of_items</code></pre>\n<p>Simple enough so far right? Well now we need to create a method to add <code>LootItem</code>s to the <code>table_contents</code> array:</p>\n<pre class=\"language-gdscript\"><code class=\"language-gdscript\"><span class=\"token comment\"># Adds an item onto this table.</span>\n<span class=\"token comment\">#</span>\n<span class=\"token comment\"># Arguments:</span>\n<span class=\"token comment\">#</span>\n<span class=\"token comment\"># `item` - The LootItem to add to this table.</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">add_item</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">:</span> <span class=\"token class-name\">LootItem</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\ttable_contents<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span></code></pre>\n<p>All we do above is add an item to the loot table which is really just adding an item to the end of the <code>table_contents</code> array.</p>\n<p>Now that the user can add items to the table, let's get into the more complicated part, rolling for items. Here's an overview of what we need to do when we roll for items:</p>\n<ol>\n<li>We need to create an array to keep track of the items that have been rolled and we need to reset our <code>unique_drops</code> array in case it contains data from previous rolls.</li>\n<li>We need to check the table for items that have <code>should_drop_always</code> set to <code>true</code>. This is because these items need to always drop so we don't need to roll for them.</li>\n<li>Get a count of the amount of items we need to roll for. This isn't just the flat out <code>num_of_items_to_roll</code> because of the step above. We need to get the amount of items to roll for after the always drops have been found. For example, let's say that you have your table set to roll for 4 items. However, in your table, there's 2 items that are set to always. In the step above we set these items aside and now the number of items to roll for is 2 not 4.</li>\n<li>Now's the fun part, we have to do some looping. The first loop is going to run as many times as we have items left to drop. Then inside it we loop through each item and check to see if it's enabled and that it doesn't already exist in the <code>unique_drops</code> array. After we get a list of the items that are eligible to be rolled for, we calculate the <code>hit_probability</code> which is going to be a random number from 0 to the total probability of each item in the list of items that can be rolled. We then loop over all of the items that can be rolled for and keep a running tally of probability while we check to see if the <code>hit_probability</code> value is less than this running value. Let's take this and expand on it to make sure that you fully understand it.</li>\n</ol>\n<p>Let's say that for example you have the following 4 items in your loot table:</p>\n<table>\n<thead>\n<tr>\n<th><strong>Item</strong></th>\n<th><strong>Probability</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Sword</td>\n<td>10</td>\n</tr>\n<tr>\n<td>Shield</td>\n<td>5</td>\n</tr>\n<tr>\n<td>Bow</td>\n<td>15</td>\n</tr>\n<tr>\n<td>Boots</td>\n<td>30</td>\n</tr>\n</tbody>\n</table>\n<p>These 4 items have a combined probability of 60. If you run a random number generator to get 2 values from 0 to 60 you might get something like: 42 and 15.</p>\n<p>Now we loop through each of these items and keep a running tally on their probability while checking to see if the hit value is less than this running tally.</p>\n<p>Let's go through the loop:</p>\n<table>\n<thead>\n<tr>\n<th><strong>Loop Item</strong></th>\n<th><strong>Running Probability Tally</strong></th>\n<th><strong>Hit Probability</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Sword</td>\n<td>10</td>\n<td>42</td>\n</tr>\n<tr>\n<td>Shield</td>\n<td>15</td>\n<td>42</td>\n</tr>\n<tr>\n<td>Bow</td>\n<td>30</td>\n<td>42</td>\n</tr>\n<tr>\n<td>Boots</td>\n<td>60</td>\n<td>42</td>\n</tr>\n</tbody>\n</table>\n<p>Now if we're checking if <code>hit_probability &#x3C; running_probability_tally</code> we'll check:</p>\n<ol>\n<li><code>42 &#x3C; 10</code> - <code>false</code></li>\n<li><code>42 &#x3C; 15</code> - <code>false</code></li>\n<li><code>42 &#x3C; 30</code> - <code>false</code></li>\n<li><code>42 &#x3C; 60</code> - <code>true</code></li>\n</ol>\n<p>This means that we'll get boots as a drop! Let's run through this again with the other random value, 15.</p>\n<ol>\n<li><code>15 &#x3C; 10</code> - <code>false</code></li>\n<li><code>15 &#x3C; 15</code> - <code>false</code></li>\n<li><code>15 &#x3C; 30</code> - <code>true</code></li>\n</ol>\n<p>Now we get a bow as our drop.</p>\n<p>Let's get into the code and see how it's done now that we got the theory set up. Let's add a new method below our constructor:</p>\n<pre class=\"language-gdscript\"><code class=\"language-gdscript\"><span class=\"token comment\"># Adds a table within this table. This is the same as adding an item but for</span>\n<span class=\"token comment\"># naming sake it exists as its own method.</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">add_table</span><span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">:</span> <span class=\"token class-name\">LootTable</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\ttable_contents<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Rolls the table (and any nested tables) for LootItems and adds the rolled</span>\n<span class=\"token comment\"># items into the `results` array.</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">roll_table</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token comment\"># The list of items that have been rolled. We also reset the unique_drops</span>\n\t<span class=\"token comment\"># array in case it was populated from previous rolls.</span>\n\t<span class=\"token keyword\">var</span> rolled_items<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Array</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\tunique_items <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\t\n\t<span class=\"token comment\"># First we look for items that are always hit. These items are always</span>\n\t<span class=\"token comment\"># returned and there is a chance that we can break the `count` limit if the</span>\n\t<span class=\"token comment\"># number of always items is greater than the number of items to roll for.</span>\n\t<span class=\"token keyword\">var</span> num_of_items_always_rolled<span class=\"token punctuation\">:</span> <span class=\"token class-name\">int</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\t<span class=\"token keyword\">for</span> loot <span class=\"token keyword\">in</span> table_contents<span class=\"token punctuation\">:</span>\n\t\t<span class=\"token keyword\">if</span> loot<span class=\"token punctuation\">.</span>should_drop_always <span class=\"token keyword\">and</span> loot<span class=\"token punctuation\">.</span>is_enabled<span class=\"token punctuation\">:</span>\n\t\t\t<span class=\"token function\">add_to_rolled_items</span><span class=\"token punctuation\">(</span>rolled_items<span class=\"token punctuation\">,</span> loot<span class=\"token punctuation\">)</span>\n\t\t\tnum_of_items_always_rolled <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n\t\n\t<span class=\"token comment\"># Now after we got all of the always items, we have to see how many more</span>\n\t<span class=\"token comment\"># items we can roll for.</span>\n\t<span class=\"token keyword\">var</span> real_drop_count<span class=\"token punctuation\">:</span> <span class=\"token class-name\">int</span> <span class=\"token operator\">=</span> num_of_items_to_roll <span class=\"token operator\">-</span> num_of_items_always_rolled\n\t\n\t<span class=\"token comment\"># Roll for more items if we still can.</span>\n\t<span class=\"token keyword\">if</span> real_drop_count <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n\t\t<span class=\"token keyword\">for</span> _i <span class=\"token keyword\">in</span> <span class=\"token function\">range</span><span class=\"token punctuation\">(</span>real_drop_count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t\t\t<span class=\"token comment\"># Find the items in the table that are eligible to be rolled and</span>\n\t\t\t<span class=\"token comment\"># were not rolled earlier.</span>\n\t\t\t<span class=\"token keyword\">var</span> loot_that_can_be_rolled<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Array</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\t\t\t<span class=\"token keyword\">var</span> total_probability <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\t\t\t<span class=\"token keyword\">for</span> table_content <span class=\"token keyword\">in</span> table_contents<span class=\"token punctuation\">:</span>\n\t\t\t\t<span class=\"token keyword\">if</span> table_content<span class=\"token punctuation\">.</span>is_enabled <span class=\"token keyword\">and</span> <span class=\"token keyword\">not</span> table_content<span class=\"token punctuation\">.</span>should_drop_always<span class=\"token punctuation\">:</span> \n\t\t\t\t\tloot_that_can_be_rolled<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>table_content<span class=\"token punctuation\">)</span>\n\t\t\t\t\ttotal_probability <span class=\"token operator\">+=</span> table_content<span class=\"token punctuation\">.</span>probability\n\t\t\t\n\t\t\t<span class=\"token comment\"># We calculate the the number that we'll compare to the probability</span>\n\t\t\t<span class=\"token comment\"># of the items to decide what item is rolled by picking a random</span>\n\t\t\t<span class=\"token comment\"># float from 0.0 to the total probability of all the items that can be rolled.</span>\n\t\t\t<span class=\"token keyword\">var</span> hit_value<span class=\"token punctuation\">:</span> <span class=\"token class-name\">float</span> <span class=\"token operator\">=</span> <span class=\"token function\">rand_range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> total_probability<span class=\"token punctuation\">)</span>\n\t\t\t\n\t\t\t<span class=\"token comment\"># Now we have to go through the list of items that can be rolled and increase</span>\n\t\t\t<span class=\"token comment\"># the probability until we find an item that meets the hit_value.</span>\n\t\t\t<span class=\"token keyword\">var</span> running_value<span class=\"token punctuation\">:</span> <span class=\"token class-name\">int</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\t\t\t<span class=\"token keyword\">for</span> loot <span class=\"token keyword\">in</span> loot_that_can_be_rolled<span class=\"token punctuation\">:</span>\n\t\t\t\trunning_value <span class=\"token operator\">+=</span> loot<span class=\"token punctuation\">.</span>probability\n\t\t\t\t<span class=\"token keyword\">if</span> hit_value <span class=\"token operator\">&lt;</span> running_value<span class=\"token punctuation\">:</span>\n\t\t\t\t\t<span class=\"token function\">add_to_rolled_items</span><span class=\"token punctuation\">(</span>rolled_items<span class=\"token punctuation\">,</span> loot<span class=\"token punctuation\">)</span>\n\t\t\t\t\t<span class=\"token keyword\">break</span>\n\t\n\t<span class=\"token comment\"># Finally we return the results of the roll.</span>\n\t<span class=\"token keyword\">return</span> rolled_items</code></pre>\n<p>Everything above is what we covered before but you'll notice something missing, what's <code>add_to_rolled_items</code>? This is the method that checks if the item is unique and if so checks the unique items array to see if this item already exists there. Otherwise it adds it to the <code>rolled_items</code> array. You're probably wondering why this method is even separate but we'll add some more advanced functionality later.</p>\n<pre class=\"language-gdscript\"><code class=\"language-gdscript\"><span class=\"token comment\"># Since we can nest tables we need to perform some checks before we just add</span>\n<span class=\"token comment\"># items to the results.</span>\n<span class=\"token comment\">#</span>\n<span class=\"token comment\"># Arguments:</span>\n<span class=\"token comment\">#</span>\n<span class=\"token comment\"># `rolled_items` - The array to append the loot to.</span>\n<span class=\"token comment\"># `loot` - The LootItem to check.</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">add_to_rolled_items</span><span class=\"token punctuation\">(</span>rolled_items<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">,</span> loot<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token comment\"># First we only want to proceed if them is not unique or if it is unique it</span>\n\t<span class=\"token comment\"># cannot exist in the unique_drops array.</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> loot<span class=\"token punctuation\">.</span>is_unique <span class=\"token keyword\">or</span> <span class=\"token keyword\">not</span> unique_items<span class=\"token punctuation\">.</span><span class=\"token function\">has</span><span class=\"token punctuation\">(</span>loot<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t\t<span class=\"token comment\"># If this is a new unique drop then we add it to the unique drops array.</span>\n\t\t<span class=\"token keyword\">if</span> loot<span class=\"token punctuation\">.</span>is_unique<span class=\"token punctuation\">:</span> unique_items<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>loot<span class=\"token punctuation\">)</span>\n\t\t\n\t\t<span class=\"token comment\"># We add the item to the results array and emit the signal for when an </span>\n\t\t<span class=\"token comment\"># item has been hit.</span>\n\t\tadd_to_rolled_items<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>loot<span class=\"token punctuation\">)</span></code></pre>\n<p>That's all for the current functionality. With everything we've covered we can create loot items and add them to a loot table and roll for items, which is what we'll do next.</p>\n<h2 id=\"lets-roll\"><a href=\"#lets-roll\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Let's Roll!</h2>\n<p>Alright now that we have the scaffolding let's make a demo. Create a new script named <code>main.gd</code> and let's get started. Here's what we have to do:</p>\n<ol>\n<li>Create an instance of a <code>LootTable</code>.</li>\n<li>Create instances of <code>LootItem</code> for all of the items we want to add to the table created in step 1.</li>\n<li>Roll for items!</li>\n</ol>\n<p>Pretty simple right? Let's get it in code:</p>\n<pre class=\"language-gdscript\"><code class=\"language-gdscript\"><span class=\"token keyword\">extends</span> <span class=\"token class-name\">Node</span>\n\n<span class=\"token comment\"># Run this on ready so we can see the results right away.</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">_ready</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token comment\"># We need to call `randomize()` so that we don't get the same results every # # time because random isn't really random.</span>\n\t<span class=\"token function\">randomize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> \n\n\t<span class=\"token comment\"># Create a loot table named \"Boss\" that's meant to roll 3 items at a time.</span>\n\t<span class=\"token keyword\">var</span> boss_loot_table<span class=\"token punctuation\">:</span> <span class=\"token class-name\">LootTable</span> <span class=\"token operator\">=</span> LootTable<span class=\"token punctuation\">.</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Boss\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n\n\t<span class=\"token comment\"># Define various items and create LootItem instances of them with the item</span>\n\t<span class=\"token comment\"># data as the first parameter.</span>\n\t<span class=\"token comment\"># None of the items are unique or set to drop always for simplicity.</span>\n\t<span class=\"token keyword\">var</span> sword<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Dictionary</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token string\">\"name\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Sword\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"attack\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"defence\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">var</span> sword_loot_item<span class=\"token punctuation\">:</span> <span class=\"token class-name\">LootItem</span> <span class=\"token operator\">=</span> LootItem<span class=\"token punctuation\">.</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>sword<span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n\t\n\t<span class=\"token keyword\">var</span> shield<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Dictionary</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token string\">\"name\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Shield\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"attack\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"defence\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">var</span> shield_loot_item<span class=\"token punctuation\">:</span> <span class=\"token class-name\">LootItem</span> <span class=\"token operator\">=</span> LootItem<span class=\"token punctuation\">.</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>shield<span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n\t\n\t<span class=\"token keyword\">var</span> bow<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Dictionary</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token string\">\"name\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Bow\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"attack\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"defence\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">var</span> bow_loot_item<span class=\"token punctuation\">:</span> <span class=\"token class-name\">LootItem</span> <span class=\"token operator\">=</span> LootItem<span class=\"token punctuation\">.</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>bow<span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n\t\n\t<span class=\"token keyword\">var</span> staff<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Dictionary</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token string\">\"name\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Staff\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"attack\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"defence\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">var</span> staff_loot_item<span class=\"token punctuation\">:</span> <span class=\"token class-name\">LootItem</span> <span class=\"token operator\">=</span> LootItem<span class=\"token punctuation\">.</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>staff<span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n\t\n\t<span class=\"token keyword\">var</span> helmet<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Dictionary</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token string\">\"name\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Helmet\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"attack\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"defence\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">7</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">var</span> helmet_loot_item<span class=\"token punctuation\">:</span> <span class=\"token class-name\">LootItem</span> <span class=\"token operator\">=</span> LootItem<span class=\"token punctuation\">.</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>helmet<span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n\n\t<span class=\"token comment\"># Add the created items 3</span>\n\tboss_loot_table<span class=\"token punctuation\">.</span><span class=\"token function\">add_item</span><span class=\"token punctuation\">(</span>sword_loot_item<span class=\"token punctuation\">)</span>\n\tboss_loot_table<span class=\"token punctuation\">.</span><span class=\"token function\">add_item</span><span class=\"token punctuation\">(</span>shield_loot_item<span class=\"token punctuation\">)</span>\n\tboss_loot_table<span class=\"token punctuation\">.</span><span class=\"token function\">add_item</span><span class=\"token punctuation\">(</span>bow_loot_item<span class=\"token punctuation\">)</span>\n\tboss_loot_table<span class=\"token punctuation\">.</span><span class=\"token function\">add_item</span><span class=\"token punctuation\">(</span>staff_loot_item<span class=\"token punctuation\">)</span>\n\tboss_loot_table<span class=\"token punctuation\">.</span><span class=\"token function\">add_item</span><span class=\"token punctuation\">(</span>helmet_loot_item<span class=\"token punctuation\">)</span>\n\n\t<span class=\"token comment\"># Roll for items.</span>\n\t<span class=\"token keyword\">var</span> roll_results<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Array</span> <span class=\"token operator\">=</span> boss_loot_table<span class=\"token punctuation\">.</span><span class=\"token function\">roll_table</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n\t<span class=\"token comment\"># Go through each of the rolled items and print out what we got.</span>\n\t<span class=\"token keyword\">for</span> rolled_item <span class=\"token keyword\">in</span> roll_results<span class=\"token punctuation\">:</span>\n\t\t<span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Rolled: \"</span><span class=\"token punctuation\">,</span> rolled_item<span class=\"token punctuation\">.</span>item<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span></code></pre>\n<p>The results of running the above should be something like:</p>\n<ul>\n<li>Helmet</li>\n<li>Bow</li>\n<li>Shield</li>\n</ul>\n<p>Of course, you'll get different results than me and you'll get different results each time you run it (unless you take out <code>randomize</code>, <code>randomize</code> guarantees we get a different number each time from <code>rand_range</code>).</p>\n<h2 id=\"whats-next\"><a href=\"#whats-next\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>What's Next?</h2>\n<p>The current setup works just fine for a table with items but what if you wanted to nest tables in tables?</p>\n<p>This might sound strange at first but think about it. Imagine you have a table that has super rare loot but you want people to maybe get lucky and roll this table when they kill a monster. You don't want to put the monster's drops on it because it only has super rare items. The solution is to create a table with a low probability and set it as an item of the monster table. This makes it so that when the monster table is rolled, the super rare table has a chance of being rolled instead of one of the items of the monster.</p>\n<p>Here's a simple diagram to illustrate it:</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 1123 554' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-a4199fa5a489fb291b4449196edc2d22'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-a4199fa5a489fb291b4449196edc2d22)' width='1123' height='554' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAgCAYAAACinX6EAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAFA0lEQVRo3uWZ%2b1MjNwzH%2bf//mbY/tDDD9Eh79EjI3AH36HAc4Q2BkHcIEB5R/dmrUsXYu9k0hA7dGY0fK9mWLH0t7y48Pj4KpM9wOJTX9qATOlJqXWnh4eEh6by/v5dOpyPtdjspu91uQtRtW/ti77PaeeV9/mnmv76%2bHjPCmAFQnOfy8lL29/el0WhIrVZL2q%2bB0AW9UJzNRmlKpcQDeFC81%2bvJa3xOT09HOx4MATVAq9VK6jZeZkn%2b42PPcxBznJycxEPAGoD4nzUQqpKrq7/L8vKylMtlWVpclK/b21IsluSnH36UUqkkN7eDmc6t41DiAb5RtD7CgHq9/mwewNPvXzkDd6TngKnpjH1zc5NQs9lMgErB%2bDkID7C7/r/DgLOzsycGeBICIObR0ZFcXV0loaCkx4rtm4Ss3DTyk4w7CS9evbe3l40Bt7e3o%2bOPcIAYhCPk8PAwGUj7ITwGCrUpz8/PZWdnJ5FjTH1veWLyobaGKGthTXnWo9gWNYC%2bCIEQMaoD5Hnu7u6kWq3OHFRZC2uaJhOMhoA9jmzdPx5DCO/zT2KANLmsh7WwpmlOo1QMAADBABYNaFBeXFxIpVJJYog6fUrHx8cjJOeY0X6VBXm33VGHnPZB8JKicvowhh0zRnY9rIU1%2besJ8Wsd3tQQUBAkblkYSoEJWto6JTwMDMhozLHjlic0xmAwSJRnYeTnGJz5LY9POpYdE0Le74vJHxwcZN8FcCsWl8cV4Uf5fr8/sRzzYWhkAN15p8KpecAILZOYHUp5vShrLlsje9v6%2bCl5Z/kxgM0fNK4/bm1KoVCQd6t/yKaTs/GOF2AAdlBdM5Y8dTotWVl5I6X1snz58tmF1Ff58L4sm1uf5O1vBfn1TUG%2bfdvNTKUnToX9TLDdakr1/OLvI6g9pqQqbj1H32FI3BwXrzearv8fpXBLFLcG8DNPbeMtdReaKIC31GqEaVXana6cuV09chjC2hh6aC47sbtAMBWeNhNESQ0BlJn0YT71AHDnxW%2bDFgNAVxYHwCkhDNk%2beOAla9TkxEdl5bV9yIH88OIJu7u7Y3K8Zy54qMdQPTY%2b6/Dng0dB0H4P0HLBnokgJkoBUIqylD7xHgV0EIvSyhNqa6kXH0Vz7Qcf8CgU4VSxc1p5v0%2bJTbF8Wmcsu/NjeYB1DRuPeTKsaZKS2Byh08HnjbXZ7bTEK/hN0AcOQiLEPKu2D0I%2b8uOBodPBtv3UXYnwsX2%2bwaMgaC2CAWyfnpexVNJ/n9W28syF20O4Kf1git7f9Z19Tz917bM8XJLsO63rpqbeBf6NAUJJRoxfrY%2brc1vEbVFYiaMT0GI3tQ9AAzB1h0mxAUorB2EAvw8%2b%2bm0oRDFgHiGgmMGRm%2bcYBNA0NFAqz5OaCL2kAVQhnpqrk%2bR0yC7ddZdQAAwHzo19bMAT%2bMSGZ2g%2bAn2XuZSuG7vj%2bhuNuguBu9E3wdTvATb7st/nLHMahXhj8moAi/bbf36WpaUll96uyLu1olT2KrL4y89Sb7afGADFUW59veRS7hXZeP8h%2bbC6sbHhyvL3srgmxWLRZY29hD%2b27rmDoBrXGmCSY9emzrh03hCIguBLhoB%2bMGHONEKOq7fyA5IokSWnBLD%2bpzCAkiOKnVG015Rb0VvbSvpdUkHQl7G8tg2velomBugZO688IJS0hP4i2aRHL2%2bT8Of6JjjPPCD0kzLLgDGePAYPtf8CL%2bcrkczavHoAAAAASUVORK5CYII=' /%3e%3c/svg%3e\" width=\"1123\" alt=\"Nested Tables\" data-srcset=\"/assets/static/nested-tables.82a2fbd.ef0bd9158f1ea3144ac343f58dc0e79e.png 480w, /assets/static/nested-tables.df6d994.ef0bd9158f1ea3144ac343f58dc0e79e.png 1123w\" data-sizes=\"(max-width: 1123px) 100vw, 1123px\" data-src=\"/assets/static/nested-tables.df6d994.ef0bd9158f1ea3144ac343f58dc0e79e.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/nested-tables.df6d994.ef0bd9158f1ea3144ac343f58dc0e79e.png\" width=\"1123\" alt=\"Nested Tables\"></noscript></p>\n<p>You can see that when you roll the monster table you have a chance to get a sword, a shield, or a drop off the rare loot table with the chances being what probabilities you choose to set.</p>\n<p>So, at this point you might be asking how we can implement it? Well it's actually pretty simple, so let's take it one step at a time:</p>\n<ol>\n<li>Copy over the properties from <code>LootItem</code>. The <code>LootTable</code> class now needs its own <code>probability</code>, <code>is_unique</code>, <code>should_drop_always</code>, and <code>is_enabled</code> properties:</li>\n</ol>\n<pre class=\"language-gdscript\"><code class=\"language-gdscript\"><span class=\"token comment\"># The probability that this table will be hit. This is used when this table is</span>\n<span class=\"token comment\"># nested within another table.</span>\n<span class=\"token keyword\">var</span> probability<span class=\"token punctuation\">:</span> <span class=\"token class-name\">int</span>\n<span class=\"token comment\"># Indicates whether this table is unique or not. This is used if the table is</span>\n<span class=\"token comment\"># nested in another and if it is unique it will only be rolled once.</span>\n<span class=\"token keyword\">var</span> is_unique<span class=\"token punctuation\">:</span> <span class=\"token class-name\">bool</span>\n<span class=\"token comment\"># Indicates whether this table should be rolled every time or not. This is used</span>\n<span class=\"token comment\"># when the table is nested within another table.</span>\n<span class=\"token keyword\">var</span> should_drop_always<span class=\"token punctuation\">:</span> <span class=\"token class-name\">bool</span>\n<span class=\"token comment\"># Indicates whether this table should be rolled for drops or not. This is used</span>\n<span class=\"token comment\"># when the table is nested within another table.</span>\n<span class=\"token keyword\">var</span> is_enabled<span class=\"token punctuation\">:</span> <span class=\"token class-name\">bool</span></code></pre>\n<ol start=\"2\">\n<li>Add the properties to the constructor like in <code>LootItem</code>:</li>\n</ol>\n<pre class=\"language-gdscript\"><code class=\"language-gdscript\"><span class=\"token comment\"># To create a new table we need to provide it with a name. If we want to nest</span>\n<span class=\"token comment\"># this table then we'll seed to provide the probability, whether its unique,</span>\n<span class=\"token comment\"># whether it should always roll, and whether it's currently enabled or not.</span>\n<span class=\"token comment\">#</span>\n<span class=\"token comment\"># Arguments:</span>\n<span class=\"token comment\">#</span>\n<span class=\"token comment\"># `u_name` - The name of this table.</span>\n<span class=\"token comment\"># `u_probability` - The probability that this table will be hit. This is used when this table is nested within another table.</span>\n<span class=\"token comment\"># `unique` - Indicates whether this table is unique or not. This is used if the table is nested in another and if it is unique it will only be rolled once.</span>\n<span class=\"token comment\"># `always_drop` - Indicates whether this table should be rolled every time or not. This is used when the table is nested within another table.</span>\n<span class=\"token comment\"># `enabled` - Indicates whether this table should be rolled for drops or not. This is used when the table is nested within another table .</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">_init</span><span class=\"token punctuation\">(</span>u_name<span class=\"token punctuation\">,</span> num_of_items<span class=\"token punctuation\">:</span> <span class=\"token class-name\">int</span><span class=\"token punctuation\">,</span> u_probability<span class=\"token punctuation\">:</span> <span class=\"token class-name\">int</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> unique<span class=\"token punctuation\">:</span> <span class=\"token class-name\">bool</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> always_drop<span class=\"token punctuation\">:</span> <span class=\"token class-name\">bool</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> enabled<span class=\"token punctuation\">:</span> <span class=\"token class-name\">bool</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\tname <span class=\"token operator\">=</span> u_name\n\tnum_of_items_to_roll <span class=\"token operator\">=</span> num_of_items\n\tprobability <span class=\"token operator\">=</span> u_probability\n\tis_unique <span class=\"token operator\">=</span> unique\n\tshould_drop_always <span class=\"token operator\">=</span> always_drop\n\tis_enabled <span class=\"token operator\">=</span> enabled</code></pre>\n<ol start=\"3\">\n<li>Optionally create a method that does the same thing as <code>add_item</code> but named <code>add_table</code> to be more verbose and easy to read in the code later.</li>\n</ol>\n<pre class=\"language-gdscript\"><code class=\"language-gdscript\"><span class=\"token comment\"># Adds a table within this table. This is the same as adding an item but for</span>\n<span class=\"token comment\"># naming sake it exists as its own method.</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">add_table</span><span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">:</span> <span class=\"token class-name\">LootTable</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\ttable_contents<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">)</span></code></pre>\n<ol start=\"3\">\n<li>Modify the <code>add_to_rolled_items</code> method to handle tables recursively by checking if the item that's rolled is a table (by having the <code>roll_table</code> method) and if so we call that table's <code>roll_table</code> method and add the rolled item/s to ours.</li>\n</ol>\n<pre class=\"language-gdscript\"><code class=\"language-gdscript\"><span class=\"token comment\"># Since we can nest tables we need to perform some checks before we just add</span>\n<span class=\"token comment\"># items to the results.</span>\n<span class=\"token comment\">#</span>\n<span class=\"token comment\"># Arguments:</span>\n<span class=\"token comment\">#</span>\n<span class=\"token comment\"># `rolled_items` - The array to append the loot to.</span>\n<span class=\"token comment\"># `loot` - The LootItem or LootTable to check.</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">add_to_rolled_items</span><span class=\"token punctuation\">(</span>rolled_items<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">,</span> loot<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token comment\"># First we only want to proceed if them is not unique or if it is unique it</span>\n\t<span class=\"token comment\"># cannot exist in the unique_drops array.</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> loot<span class=\"token punctuation\">.</span>is_unique <span class=\"token keyword\">or</span> <span class=\"token keyword\">not</span> unique_items<span class=\"token punctuation\">.</span><span class=\"token function\">has</span><span class=\"token punctuation\">(</span>loot<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t\t<span class=\"token comment\"># If this is a new unique drop then we add it to the unique drops array.</span>\n\t\t<span class=\"token keyword\">if</span> loot<span class=\"token punctuation\">.</span>is_unique<span class=\"token punctuation\">:</span> unique_items<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>loot<span class=\"token punctuation\">)</span>\n\t\t\n\t\t<span class=\"token comment\"># Since we could be rolling a table we want to keep the loot to add in</span>\n\t\t<span class=\"token comment\"># an array so we can loop through and emit signals without extra work.</span>\n\t\t<span class=\"token keyword\">var</span> items_to_add <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>loot<span class=\"token punctuation\">]</span>\n\t\t\n\t\t<span class=\"token comment\"># If the item has a `roll_table` method then it is a LootTable and </span>\n\t\t<span class=\"token comment\"># we need to call `roll_table` recursively and add the results to </span>\n\t\t<span class=\"token comment\"># the array.</span>\n\t\t<span class=\"token keyword\">if</span> loot<span class=\"token punctuation\">.</span><span class=\"token function\">has_method</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"roll_table\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> items_to_add <span class=\"token operator\">=</span> loot<span class=\"token punctuation\">.</span><span class=\"token function\">roll_table</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t\n\t\t<span class=\"token comment\"># For each item rolled we add it to the `rolled_items` array and emit</span>\n\t\t<span class=\"token comment\"># the hit signal.</span>\n\t\t<span class=\"token keyword\">for</span> loot_item <span class=\"token keyword\">in</span> items_to_add<span class=\"token punctuation\">:</span>\n\t\t\trolled_items<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>loot_item<span class=\"token punctuation\">)</span>\n\t\t\tloot<span class=\"token punctuation\">.</span><span class=\"token function\">emit_signal</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hit\"</span><span class=\"token punctuation\">)</span></code></pre>\n<p>That's all for nesting tables, the full <code>LootTable</code> class with nested table support can be found below:</p>\n<pre class=\"language-gdscript\"><code class=\"language-gdscript\"><span class=\"token keyword\">extends</span> <span class=\"token class-name\">Resource</span>\n\n<span class=\"token comment\"># A LootTable defines a table that holds one or more LootItems/LootTables and it</span>\n<span class=\"token comment\"># can roll to return one or more items.</span>\n<span class=\"token keyword\">class_name</span> <span class=\"token class-name\">LootTable</span>\n\n<span class=\"token comment\"># The name of this loot table.</span>\n<span class=\"token keyword\">var</span> name<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span>\n\n<span class=\"token comment\"># The probability that this table will be hit. This is used when this table is</span>\n<span class=\"token comment\"># nested within another table.</span>\n<span class=\"token keyword\">var</span> probability<span class=\"token punctuation\">:</span> <span class=\"token class-name\">int</span>\n<span class=\"token comment\"># Indicates whether this table is unique or not. This is used if the table is</span>\n<span class=\"token comment\"># nested in another and if it is unique it will only be rolled once.</span>\n<span class=\"token keyword\">var</span> is_unique<span class=\"token punctuation\">:</span> <span class=\"token class-name\">bool</span>\n<span class=\"token comment\"># Indicates whether this table should be rolled every time or not. This is used</span>\n<span class=\"token comment\"># when the table is nested within another table.</span>\n<span class=\"token keyword\">var</span> should_drop_always<span class=\"token punctuation\">:</span> <span class=\"token class-name\">bool</span>\n<span class=\"token comment\"># Indicates whether this table should be rolled for drops or not. This is used</span>\n<span class=\"token comment\"># when the table is nested within another table.</span>\n<span class=\"token keyword\">var</span> is_enabled<span class=\"token punctuation\">:</span> <span class=\"token class-name\">bool</span>\n\n<span class=\"token comment\"># Indicates the amount of items that will be rolled off this table.</span>\n<span class=\"token keyword\">var</span> num_of_items_to_roll<span class=\"token punctuation\">:</span> <span class=\"token class-name\">int</span>\n<span class=\"token comment\"># The LootItems in this table.</span>\n<span class=\"token keyword\">var</span> table_contents<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Array</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token comment\"># Any unique items are added here when they are hit so that they cannot drop a</span>\n<span class=\"token comment\"># second time.</span>\n<span class=\"token keyword\">var</span> unique_items<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Array</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\"># To create a new table we need to provide it with a name. If we want to nest</span>\n<span class=\"token comment\"># this table then we'll seed to provide the probability, whether its unique,</span>\n<span class=\"token comment\"># whether it should always roll, and whether it's currently enabled or not.</span>\n<span class=\"token comment\">#</span>\n<span class=\"token comment\"># Arguments:</span>\n<span class=\"token comment\">#</span>\n<span class=\"token comment\"># `u_name` - The name of this table.</span>\n<span class=\"token comment\"># `u_probability` - The probability that this table will be hit. This is used when this table is nested within another table.</span>\n<span class=\"token comment\"># `unique` - Indicates whether this table is unique or not. This is used if the table is nested in another and if it is unique it will only be rolled once.</span>\n<span class=\"token comment\"># `always_drop` - Indicates whether this table should be rolled every time or not. This is used when the table is nested within another table.</span>\n<span class=\"token comment\"># `enabled` - Indicates whether this table should be rolled for drops or not. This is used when the table is nested within another table .</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">_init</span><span class=\"token punctuation\">(</span>u_name<span class=\"token punctuation\">,</span> num_of_items<span class=\"token punctuation\">:</span> <span class=\"token class-name\">int</span><span class=\"token punctuation\">,</span> u_probability<span class=\"token punctuation\">:</span> <span class=\"token class-name\">int</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> unique<span class=\"token punctuation\">:</span> <span class=\"token class-name\">bool</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> always_drop<span class=\"token punctuation\">:</span> <span class=\"token class-name\">bool</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> enabled<span class=\"token punctuation\">:</span> <span class=\"token class-name\">bool</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\tname <span class=\"token operator\">=</span> u_name\n\tnum_of_items_to_roll <span class=\"token operator\">=</span> num_of_items\n\tprobability <span class=\"token operator\">=</span> u_probability\n\tis_unique <span class=\"token operator\">=</span> unique\n\tshould_drop_always <span class=\"token operator\">=</span> always_drop\n\tis_enabled <span class=\"token operator\">=</span> enabled\n\n<span class=\"token comment\"># Adds an item onto this table.</span>\n<span class=\"token comment\">#</span>\n<span class=\"token comment\"># Arguments:</span>\n<span class=\"token comment\">#</span>\n<span class=\"token comment\"># `item` - The LootItem to add to this table.</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">add_item</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">:</span> <span class=\"token class-name\">LootItem</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\ttable_contents<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Adds a table within this table. This is the same as adding an item but for</span>\n<span class=\"token comment\"># naming sake it exists as its own method.</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">add_table</span><span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">:</span> <span class=\"token class-name\">LootTable</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\ttable_contents<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Rolls the table (and any nested tables) for LootItems and adds the rolled</span>\n<span class=\"token comment\"># items into the `results` array.</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">roll_table</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token comment\"># The list of items that have been rolled. We also reset the unique_drops</span>\n\t<span class=\"token comment\"># array in case it was populated from previous rolls.</span>\n\t<span class=\"token keyword\">var</span> rolled_items<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Array</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\tunique_items <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\t\n\t<span class=\"token comment\"># For each table or item added we now emit the pre-roll signal.</span>\n\t<span class=\"token keyword\">for</span> loot <span class=\"token keyword\">in</span> table_contents<span class=\"token punctuation\">:</span> loot<span class=\"token punctuation\">.</span><span class=\"token function\">emit_signal</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pre_roll\"</span><span class=\"token punctuation\">)</span>\n\t\n\t<span class=\"token comment\"># First we look for items that are always hit. These items are always</span>\n\t<span class=\"token comment\"># returned and there is a chance that we can break the `count` limit if the</span>\n\t<span class=\"token comment\"># number of always items is greater than the number of items to roll for.</span>\n\t<span class=\"token keyword\">var</span> num_of_items_always_rolled<span class=\"token punctuation\">:</span> <span class=\"token class-name\">int</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\t<span class=\"token keyword\">for</span> loot <span class=\"token keyword\">in</span> table_contents<span class=\"token punctuation\">:</span>\n\t\t<span class=\"token keyword\">if</span> loot<span class=\"token punctuation\">.</span>should_drop_always <span class=\"token keyword\">and</span> loot<span class=\"token punctuation\">.</span>is_enabled<span class=\"token punctuation\">:</span>\n\t\t\t<span class=\"token function\">add_to_rolled_items</span><span class=\"token punctuation\">(</span>rolled_items<span class=\"token punctuation\">,</span> loot<span class=\"token punctuation\">)</span>\n\t\t\tnum_of_items_always_rolled <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n\t\n\t<span class=\"token comment\"># Now after we got all of the always items, we have to see how many more</span>\n\t<span class=\"token comment\"># items we can roll for.</span>\n\t<span class=\"token keyword\">var</span> real_drop_count<span class=\"token punctuation\">:</span> <span class=\"token class-name\">int</span> <span class=\"token operator\">=</span> num_of_items_to_roll <span class=\"token operator\">-</span> num_of_items_always_rolled\n\t\n\t<span class=\"token comment\"># Roll for more items if we still can.</span>\n\t<span class=\"token keyword\">if</span> real_drop_count <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n\t\t<span class=\"token keyword\">for</span> _i <span class=\"token keyword\">in</span> <span class=\"token function\">range</span><span class=\"token punctuation\">(</span>real_drop_count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t\t\t<span class=\"token comment\"># Find the items in the table that are eligible to be rolled and</span>\n\t\t\t<span class=\"token comment\"># were not rolled earlier.</span>\n\t\t\t<span class=\"token keyword\">var</span> loot_that_can_be_rolled<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Array</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\t\t\t<span class=\"token keyword\">var</span> total_probability <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\t\t\t<span class=\"token keyword\">for</span> table_content <span class=\"token keyword\">in</span> table_contents<span class=\"token punctuation\">:</span>\n\t\t\t\t<span class=\"token keyword\">if</span> table_content<span class=\"token punctuation\">.</span>is_enabled <span class=\"token keyword\">and</span> <span class=\"token keyword\">not</span> table_content<span class=\"token punctuation\">.</span>should_drop_always<span class=\"token punctuation\">:</span> \n\t\t\t\t\tloot_that_can_be_rolled<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>table_content<span class=\"token punctuation\">)</span>\n\t\t\t\t\ttotal_probability <span class=\"token operator\">+=</span> table_content<span class=\"token punctuation\">.</span>probability\n\t\t\t\n\t\t\t<span class=\"token comment\"># We calculate the the number that we'll compare to the probability</span>\n\t\t\t<span class=\"token comment\"># of the items to decide what item is rolled by picking a random</span>\n\t\t\t<span class=\"token comment\"># float from 0.0 to the total probability of all the items that can be rolled.</span>\n\t\t\t<span class=\"token keyword\">var</span> hit_value<span class=\"token punctuation\">:</span> <span class=\"token class-name\">float</span> <span class=\"token operator\">=</span> <span class=\"token function\">rand_range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> total_probability<span class=\"token punctuation\">)</span>\n\t\t\t\n\t\t\t<span class=\"token comment\"># Now we have to go through the list of items that can be rolled and increase</span>\n\t\t\t<span class=\"token comment\"># the probability until we find an item that meets the hit_value.</span>\n\t\t\t<span class=\"token keyword\">var</span> running_value<span class=\"token punctuation\">:</span> <span class=\"token class-name\">int</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\t\t\t<span class=\"token keyword\">for</span> loot <span class=\"token keyword\">in</span> loot_that_can_be_rolled<span class=\"token punctuation\">:</span>\n\t\t\t\trunning_value <span class=\"token operator\">+=</span> loot<span class=\"token punctuation\">.</span>probability\n\t\t\t\t<span class=\"token keyword\">if</span> hit_value <span class=\"token operator\">&lt;</span> running_value<span class=\"token punctuation\">:</span>\n\t\t\t\t\t<span class=\"token function\">add_to_rolled_items</span><span class=\"token punctuation\">(</span>rolled_items<span class=\"token punctuation\">,</span> loot<span class=\"token punctuation\">)</span>\n\t\t\t\t\t<span class=\"token keyword\">break</span>\n\t\n\t<span class=\"token comment\"># Now for each item we rolled we dispatch the post roll signal.</span>\n\t<span class=\"token keyword\">for</span> o <span class=\"token keyword\">in</span> rolled_items<span class=\"token punctuation\">:</span> o<span class=\"token punctuation\">.</span><span class=\"token function\">emit_signal</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"post_roll\"</span><span class=\"token punctuation\">)</span>\n\t\n\t<span class=\"token comment\"># Finally we return the results of the roll.</span>\n\t<span class=\"token keyword\">return</span> rolled_items\n\n<span class=\"token comment\"># Since we can nest tables we need to perform some checks before we just add</span>\n<span class=\"token comment\"># items to the results.</span>\n<span class=\"token comment\">#</span>\n<span class=\"token comment\"># Arguments:</span>\n<span class=\"token comment\">#</span>\n<span class=\"token comment\"># `rolled_items` - The array to append the loot to.</span>\n<span class=\"token comment\"># `loot` - The LootItem or LootTable to check.</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">add_to_rolled_items</span><span class=\"token punctuation\">(</span>rolled_items<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">,</span> loot<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token comment\"># First we only want to proceed if them is not unique or if it is unique it</span>\n\t<span class=\"token comment\"># cannot exist in the unique_drops array.</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> loot<span class=\"token punctuation\">.</span>is_unique <span class=\"token keyword\">or</span> <span class=\"token keyword\">not</span> unique_items<span class=\"token punctuation\">.</span><span class=\"token function\">has</span><span class=\"token punctuation\">(</span>loot<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t\t<span class=\"token comment\"># If this is a new unique drop then we add it to the unique drops array.</span>\n\t\t<span class=\"token keyword\">if</span> loot<span class=\"token punctuation\">.</span>is_unique<span class=\"token punctuation\">:</span> unique_items<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>loot<span class=\"token punctuation\">)</span>\n\t\t\n\t\t<span class=\"token comment\"># Since we could be rolling a table we want to keep the loot to add in</span>\n\t\t<span class=\"token comment\"># an array so we can loop through and emit signals without extra work.</span>\n\t\t<span class=\"token keyword\">var</span> items_to_add <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>loot<span class=\"token punctuation\">]</span>\n\t\t\n\t\t<span class=\"token comment\"># If the item has a `roll_table` method then it is a LootTable and </span>\n\t\t<span class=\"token comment\"># we need to call `roll_table` recursively and add the results to </span>\n\t\t<span class=\"token comment\"># the array.</span>\n\t\t<span class=\"token keyword\">if</span> loot<span class=\"token punctuation\">.</span><span class=\"token function\">has_method</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"roll_table\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> items_to_add <span class=\"token operator\">=</span> loot<span class=\"token punctuation\">.</span><span class=\"token function\">roll_table</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t\n\t\t<span class=\"token comment\"># For each item rolled we add it to the `rolled_items` array and emit</span>\n\t\t<span class=\"token comment\"># the hit signal.</span>\n\t\t<span class=\"token keyword\">for</span> loot_item <span class=\"token keyword\">in</span> items_to_add<span class=\"token punctuation\">:</span>\n\t\t\trolled_items<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>loot_item<span class=\"token punctuation\">)</span>\n\t\t\tloot<span class=\"token punctuation\">.</span><span class=\"token function\">emit_signal</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hit\"</span><span class=\"token punctuation\">)</span></code></pre>\n<p>Now let's modify our <code>main.gd</code> so we can test this out:</p>\n<ol>\n<li>Let's start out by creating a couple <code>LootTables</code> that will be nested in our Boss table. We'll give the Common table a 3x greater chance to be hit than the Rare drop table.</li>\n</ol>\n<pre class=\"language-gdscript\"><code class=\"language-gdscript\">\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\t<span class=\"token comment\"># Create our nested tables and add them to the Boss table.</span>\n\t<span class=\"token keyword\">var</span> common_drop_table<span class=\"token punctuation\">:</span> <span class=\"token class-name\">LootTable</span> <span class=\"token operator\">=</span> LootTable<span class=\"token punctuation\">.</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Common\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">var</span> rare_drop_table<span class=\"token punctuation\">:</span> <span class=\"token class-name\">LootTable</span> <span class=\"token operator\">=</span> LootTable<span class=\"token punctuation\">.</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Rare\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n\t\n\tboss_loot_table<span class=\"token punctuation\">.</span><span class=\"token function\">add_table</span><span class=\"token punctuation\">(</span>common_drop_table<span class=\"token punctuation\">)</span>\n\tboss_loot_table<span class=\"token punctuation\">.</span><span class=\"token function\">add_table</span><span class=\"token punctuation\">(</span>rare_drop_table<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre>\n<ol start=\"2\">\n<li>Instead of adding the items directly to the Boss table, let's split them up onto the two sub-tables.</li>\n</ol>\n<pre class=\"language-gdscript\"><code class=\"language-gdscript\">    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\tcommon_drop_table<span class=\"token punctuation\">.</span><span class=\"token function\">add_item</span><span class=\"token punctuation\">(</span>sword_loot_item<span class=\"token punctuation\">)</span>\n\tcommon_drop_table<span class=\"token punctuation\">.</span><span class=\"token function\">add_item</span><span class=\"token punctuation\">(</span>shield_loot_item<span class=\"token punctuation\">)</span>\n\tcommon_drop_table<span class=\"token punctuation\">.</span><span class=\"token function\">add_item</span><span class=\"token punctuation\">(</span>bow_loot_item<span class=\"token punctuation\">)</span>\n\trare_drop_table<span class=\"token punctuation\">.</span><span class=\"token function\">add_item</span><span class=\"token punctuation\">(</span>staff_loot_item<span class=\"token punctuation\">)</span>\n\trare_drop_table<span class=\"token punctuation\">.</span><span class=\"token function\">add_item</span><span class=\"token punctuation\">(</span>helmet_loot_item<span class=\"token punctuation\">)</span>\n\trare_drop_table<span class=\"token punctuation\">.</span><span class=\"token function\">add_item</span><span class=\"token punctuation\">(</span>platebody_loot_item<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre>\n<ol start=\"3\">\n<li>Now we press play and see the results of the roll! In my demo I set the Boss table to drop 2 items and my 2 ended up being:</li>\n</ol>\n<ul>\n<li>Staff</li>\n<li>\n<p>Bow</p>\n<p>Now this time we actually hit the rare drop table, but in another roll I got:</p>\n</li>\n<li>Bow</li>\n<li>\n<p>Sword</p>\n<p>So that time I hit the common table for both items.</p>\n</li>\n</ul>\n<h2 id=\"bonus\"><a href=\"#bonus\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Bonus!</h2>\n<p>In the article that gave me the inspiration for this, the author implements events for the loot items and table and I figured it may be useful to someone so here's a bonus section for it. So an event based system in Godot would involve signals and we're going to create a custom signal that will get emitted when an item on the drop table is it or even when a table within a table is hit. One example of when this could be useful is in a multiplayer game if you want to notify every player when someone gets a super rare drop.</p>\n<p>So this is actually pretty easy. To do this, open up your <code>loot_item</code> class and add the <code>hit</code> signal below the variables.</p>\n<pre class=\"language-gdscript\"><code class=\"language-gdscript\"><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token keyword\">var</span> is_enabled<span class=\"token punctuation\">:</span> <span class=\"token class-name\">bool</span>\n\n<span class=\"token comment\"># The signal that gets emitted when this item is hit on the drop table.</span>\n<span class=\"token keyword\">signal</span> hit\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre>\n<p>Now in the <code>loot_table</code> class, we want to go down to our <code>add_to_rolled_items</code> method and right below where we append the the item to the <code>rolled_items</code> array and emit the signal like so:</p>\n<pre class=\"language-gdscript\"><code class=\"language-gdscript\"><span class=\"token comment\"># For each item rolled we add it to the `rolled_items` array and emit</span>\n<span class=\"token comment\"># the hit signal.</span>\n<span class=\"token keyword\">for</span> loot_item <span class=\"token keyword\">in</span> items_to_add<span class=\"token punctuation\">:</span>\n\trolled_items<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>loot_item<span class=\"token punctuation\">)</span>\n\tloot<span class=\"token punctuation\">.</span><span class=\"token function\">emit_signal</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hit\"</span><span class=\"token punctuation\">)</span></code></pre>\n<p>Finally, head over to the <code>main.gd</code> file we created to test our loot system and add a signal to one of the items (I picked the shield) like so:</p>\n<pre class=\"language-gdscript\"><code class=\"language-gdscript\"><span class=\"token keyword\">var</span> shield<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Dictionary</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token string\">\"name\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Shield\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string\">\"attack\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string\">\"defence\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> shield_loot_item<span class=\"token punctuation\">:</span> <span class=\"token class-name\">LootItem</span> <span class=\"token operator\">=</span> LootItem<span class=\"token punctuation\">.</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>shield<span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Connect the shield's hit signal to a function named \"_on_shield_rolled\".</span>\nshield_loot_item<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hit\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"_on_shield_rolled\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># This function is going to print to the console when we roll the shield.</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">_on_shield_rolled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"We rolled a shield!\"</span><span class=\"token punctuation\">)</span></code></pre>\n<p>Just make sure you have a function in the <code>main.gd</code> file that you can attach the function to as shown above whenever you roll the shield you should see that message print to the console.</p>\n<p>Of course this means that if you have nested tables then the signal will be emitted twice because the sub table will roll it and then the main table also will so the signal gets emitted twice so you can change the <code>emit_signal</code> to also include the table object like so:</p>\n<pre class=\"language-gdscript\"><code class=\"language-gdscript\"><span class=\"token comment\"># For each item rolled we add it to the `rolled_items` array and emit</span>\n<span class=\"token comment\"># the hit signal.</span>\n<span class=\"token keyword\">for</span> loot_item <span class=\"token keyword\">in</span> items_to_add<span class=\"token punctuation\">:</span>\n\trolled_items<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>loot_item<span class=\"token punctuation\">)</span>\n\tloot<span class=\"token punctuation\">.</span><span class=\"token function\">emit_signal</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hit\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span></code></pre>\n<p>Then, in your <code>_on_shield_rolled</code> function you can check to see if the main boss table rolled it like so:</p>\n<pre class=\"language-gdscript\"><code class=\"language-gdscript\"><span class=\"token comment\"># This function is going to print to the console when we roll the shield.</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">_on_shield_rolled</span><span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">:</span> <span class=\"token class-name\">LootTable</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token keyword\">if</span> table<span class=\"token punctuation\">.</span>name <span class=\"token operator\">==</span> <span class=\"token string\">\"Boss\"</span><span class=\"token punctuation\">:</span> <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"We rolled a shield!\"</span><span class=\"token punctuation\">)</span></code></pre>\n<p>There's other ways this could be handled but I'll leave that as a challenge to you, the above gets you 95% of the way there.</p>\n<h2 id=\"conclusion\"><a href=\"#conclusion\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Conclusion</h2>\n<p> Now that you have the basic workings of a loot system, the challenge for you is to figure out how to best implement it in your game. You could for example not provide any item definitions when creating items but instead just provide an id of an item that links to an id of a resource somewhere else like a database. Also since the loot items and tables are resources you could make your items into resources in Godot (sword.tres, shield.tres, etc) and on another class you could ask for an export of items/tables so you don't have to do it by code. I might expand on these concepts in a later tutorial but for now let me know if you have any questions and I'll gladly answer them!</p>\n"}},{"node":{"title":"Rotating Rigidbodies with PID Controllers","path":"/rotating-rigidbodies-with-pid-controllers/","date":"8. July 2020","timeToRead":12,"description":"Rotating your Rigidbodies can be a breeze with PID controllers","cover_image":{"type":"image","mimeType":"image/png","src":"/assets/static/main.07cc2b7.65aebe05b2b3a3b1d82aa1374ff65143.png","size":{"width":860,"height":378},"sizes":"(max-width: 860px) 100vw, 860px","srcset":["/assets/static/main.a67b0b2.65aebe05b2b3a3b1d82aa1374ff65143.png 480w","/assets/static/main.07cc2b7.65aebe05b2b3a3b1d82aa1374ff65143.png 860w"],"dataUri":"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 860 378' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-26939c8d9c934742f0a2e84a153930c0'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='10'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-26939c8d9c934742f0a2e84a153930c0)' width='860' height='378' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAcCAYAAADRJblSAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAMv0lEQVRYw1VZXY/juBH0zliiRFKivi17PvZub3eTyyUX4HAJkBwS5CHISxAEyP//L0xVNeWZe2hYlm2RXV1d3U2f2rrNtNj0uW%2bG3DUpD%2b2YBz/ltd9wb9I9ftbjNbio1%2bhC7mhNhAX8PuizgHuts%2bvOdfisw/NSnvyYt/6SL/0tL3GFbXmOC%2b7PeQ6LrnlvifzOVd%2bZcH/A71LL9fucsC6f12PNKaZ8GZfct1HvuUbiWtw/9kofRjx7bCdcT3gG3095CXO%2bdGu%2bpS1/HC751NRNbgCAr%2bGENgwQHBfEws2SEx4yhBULLXCSAHQyX3t8P%2bJeFBh03Bdr8NkbANzcoMW3Ds6lW17xuvW7HOb9iWDL%2bRWf7QLpgs9XbJQbZ3A6GtfG87zzAtzWDwpAL2A67LlXgASCbDSj8wB578xu/ZqfhzWfvCMDPKJmm07cKJBRxB1Qw4/mbsNiA4ybwAKwI9pyHhswJjX2LBgBDWKJATAFizQBuI6vuqbzjNDoF4HCDRoA1/J%2bBvCDOQ%2bj461DwJwzEFoEovFlH1gnJIHAPfL7ZEASA2aBvMUpX7s5P/VLvsKeyAA%2byCzc6U3aEYAkFoxiRa80MCoyElww0MkaERGD6HTMTQUQKnvPzw8AFGmAQMfo5BF9UpVpsCLiGxwnMwjABek3%2bEEAcM0gZhlbGwENc3ad4JiCFxiw2Zh8BAt7J8hrMOeviPxTYgpYGpw63wlVIeo6c9IxnwalgXIJCBIIfsb0IBPoeAJQHXKPm/El6ncA7jrQGwPg7AwARPN4gHBRlJjrk/JzRZqA%2bvrOmkdqQNsr78kwPrup7JXvXeX0egSQe/FIEd6z4HQKFvVhw9pX5f4O6j8hBXaAAQakMGjjrbOctiiPxWFjwnAIiURyKOlhuXZsjr/1ZZPGgHeMkgCN5qRyHSYduAGU9c6OmcJIMHgPRuEUADDuz5w3M0BaYwSBKexw5Z4v7EwAgM%2b%2bMP/x/B0A32hg2Y49nHpQw8MJIVhyTc65VNLgEMV0zy3eJwtiHcUaXgvE%2bwbJqCix5Od8BtOK0abjCzTFhPAq8TMAFn1GllCwktIQTIPFsj9qy69AqLzWcmJGU5jh3%2blQCwGEFoABK565g1VXOX8TGBfYKbax0NWE5FDbWBw2upuTZqwCvVWDAkCn6lCEsGzkqCoqXyyr7WS5jkWZ51tCBGBbt1m58hZ5ApGQcgHfD/hdAHihIbWxLzjBa2NAKJrzBogrABg4TAOv0jjiNzMBwFpXgHylxiD9tgAGmPpb9JMvSq86bw56gUIhnPDQYAsXUGj9/btBC/oiVgTDGIVIlhQymiPSwdR%2bkyBeiuOkPOs%2bDeqPDUcBYWB4AYH98RqMJBDcS6s99nDaHHe1pYOrjj0EsWACmNSYWUDP9yp0Ui0tkeIm5XxjEY5YUAvUyEFaRdSNAV69QLRqoPy3MjrBweBMEPs2mWa0o7GAOqBKsIsFdN6anoMFs1UGpcCkiHd%2bhQasBgbAjLg2QAhAB6cB%2bLnV3ngtAEp1UCAg8Im9CIPBhqodSpVL2tOJjs4oDcw5ImoCEmV6f/YyVxY5WEDE1fjUhwFtpNM2baVJCqUMvWlJOhoiOH9LT%2bZ4oT2jPyr/R5W/AeLMJqzD/d5vAiE0k8wDiNYlscLXScHgnhz3WVmf0NQ1DK/OyqUZ9uQJRCdR9WCHABgCW95Z0T7EhY7WeFh9Zn5FvDp9drweeUggArswj2j7mJdhKp1alJhaGlhZZTVgCjD32enNyMMpbqL8AUJShJJKp7rQuOPZ6EQJRFvAAFBHKpCZ1AdLh077cXDcAQS%2bKh2cAeHboNfDCMiJkTZRGwuNrJQ4OU5EgwCQ848u9wGp0k1gxduCBJE0t5oM8XGtymMqjt%2bj35raX1JphZEKc2dADCVN2Per92f6sAts2Y5vMjlPjUDqUCClC%2b5gAQQazGnU1SLve6YK9t6gV0C3%2bN7xpmnNsM9TIIJ4gDnv72pan70Y4UpuHalgIhjuKfFehan%2bdL4HtVJrDZAiWTpJ0v%2bK7us67GLBbXiW80wDimwnAAws6zGSIp38pejAUjRhUfQJAAEZO5S1%2bSMcHhQUGVi4zzvYAh8YbTjcFqcbtu5NSQEKnDnu5WhUKvhcgeq1rJGzDq%2bKetGAwDyq7Tf3GlwASEB%2baI0BR8OU4ODX6zX/7iNqfRzz0/gMAG5qfph%2bny57/m6/lJ5hKCywxquDAB4A0Dy1AIz1iH6PFEnxClbgO2EsYh2N/o3pgXO1rn1rTPBy3q5PRncrG4w2kXUAowLdnXKeihoEBAGhPlBs1hH528/63FLBlDdQdVtWgE4ssOEEjHlo8%2bd9yT9/uur3bHnJAlaEiTU5kW0f9P1RDLDKZABMpgFigrEgKFBFA6gFziqCaVZhrTsE0RUdaO%2bVwcABAKQ6WVAXZ6W0WNAVVjiZ6UJbdQKiEQuMOfyN7hWlJQAR6HJOHyCKCTRbujH/9OMPuUsJHViT//bpRZPYGJD/4SJdCHpeq5Z5uAPQ2TDUspeYCwNmMYIlkQygRTVNyUS8ftvvwUxVg/qdKNZvWnCqFH1TefthMDAqc6w6V/n8WFsK6HuN0iACKL5nqohiMBuqCICxYCQAAGUZx/yff/2S//abb/Wsv/zxa/7fLz/lP3/%2bLn%2b6cjTeymGJtcVsyJLv38RQzdSiasA%2bIDaLUtUXEFJc1BeoN1FPErRfqww2NB19wQHCIYgAoIazVPJJtCcQvFeJ8lYK6Shpa3rghTZRrx75wFoAkGJtcwDgEUWOwR6ljWNzmz%2bcTvmHywBHYz49PObff/85//uvP%2bZ/AoxP8xXCaCMwzwTEApTCkeOteoNVpTqxXIMxTIUgRhgT1Bu4VKjv3zVrQUInYT8XBiAgnH241%2bh9Pp0fq3utp%2bPUAgLByPIzGzSIqCk/U6ZBKlAXGvb/UldfyorDZryOqEj90QcBsERrbE4fPuQTgKA9PDzkZUXnN6b8aV/z3rMtJhM2OU3nJwxq1Iepu8JumPVpT9KAQxDpfGJDhbJ6aEF41yq7UqHYRjNYdD5ypmgb6NhkDKDR2eqxVsTbpitMKGwAIOfCiupc%2bgSg6UnPgDyNUfnPTpBzRYIATh4dJuyC/L8OcHDYAGB9B%2bC9sVa/zJwFykwQ5vt4vKbXvI3f5KV/QceKstk9AZwb2ABBRF9gIIwFlFmp0AdLCVU16gcctpJ%2bUL8toggGVHS8gFAVHWBTcX48GwCPrmiBAWDO10VErNHwoFMAA8aQrPwBiAm2RoheP%2bXbuMIuUP1NonQ4/qEw4uXlmn/48jH/6euXfFte8PvFIo8Sd5k/5evyBQBAKwDCRABQ9mgDQGBqUBQJSIKo9uwp0EE2tbFUjGDLzGYPQNWVu3eG0oCmjsU5AFHVdzBU9sgIRJxRr5QOriiq/ZgPYj21g0meyXGi7Gz4ABAzT27JgH6R82yCdnSBbJMPEAjmfsGEuE75v//4Of/9%2by9yZoxm6/AKUL4KALEAqUDjd5gWBIGRjxRKMIIdYssWnCzQlBhLGnhLAw1MbekPHPuARqjQqqoSEEKp9P2sEGdpQ/1WSu5tpSulzxdhsXOFnq2oOsEeI%2biAOdzO4i6Jtknwpjjlhw8Pv0oFH3z%2bw%2buWf3u5IZI7AIAmAIA1fVQqkP60ff0OOf%2bkDtEGJc4JawFgUo%2bgVtklNVBkAvfXSBOsyrXqBtEJHicqZu%2bBqEsn6OzsjU2EWsq3EkKFbZ2/T1ZB/xEw8jyFHWwO5/8B6Px2ncSayFHtX6YX/e/waz34oG5tnzESHwxIz3mB82bPoj7TQN2fZwrsYgCd75kOGqA27GkQ5dWk8WgMgLc6q4hvLGAfcBxkHgeOqgLnIoZCrBYAdnja2jF0a2Nz1IlNp%2bnPDlWse5u7Ve0sy9kcJgOA5/FgwRap%2bDYOv06vAOOSH1EWCQB1Z4qrqMroUwPEAND/On3G9UdVgiTHoQPhSSD0ftewxI6Rg9KcdqWB0qF0i66kgh2qjNbomQY0bweL71hwnKrwyKwPsbSPpdt7H3lnkWfZ4gHHGKyLYxMzsozh/Qr0%2bW/M3vHUlwBwEHrKz%2bNrfsUQc9E/UCmfHyop9oLcpvMLyp8YgNy/jp/zPn4LMF7UQVLwlu6jrlkNSHumAsdnTogEgEI4gClkAu/bFMkqYQB4pOjpOGdXe3icrpZDBILRd6DxsKhktI2Nvq0ajF7RjzpKQ81GDV%2bQ41dMYKlMgSNYMBOYyH%2bFFgFAZ3edBz5BC55QHfCK99d0Q3tsJ0UjR2SdFO35efo2v6xf4TyAGr7FzPANGPasUkg2DP4qRgRNk2uZE5j/sHowgeQYjhL6tH7BPi/wpYO/KJHY9/8Bgj0ABAkJf8EAAAAASUVORK5CYII=' /%3e%3c/svg%3e"},"content":"<h2 id=\"what-is-a-pid-controller\"><a href=\"#what-is-a-pid-controller\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>What is a PID controller?</h2>\n<p>A PID controller is a type of control system that uses past values, current values, and estimated future values to drive a system towards a target value. We're going to create a PID controller and use it to drive a Rigidbody towards a desired angle.</p>\n<p>The inspiration for this article came about when I was doing research on the best ways to rotate a Rigidbody and I stumbled upon a <a href=\"https://forum.unity.com/threads/rigidbody-lookat-torque.146625/#post-1005645\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">forum post</a> that mentioned using a PID controller. The person also linked an example project which most of the code below is based off of and after I saw what it did I decided to learn more about PID controllers myself and eventually I decided to write this article to help the next person that stumbles upon this same scenario that wants a detail explanation and guide.</p>\n<p>I'd highly recommend checking out the above linked forum post but I'm going to go over the code and expand on it a bit in a more complex example that can also be found on my <a href=\"https://github.com/robertcorponoi/unity-pid-with-rigidbodies\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Github</a>.</p>\n<p>Now for a quick overview of PID controllers:</p>\n<ul>\n<li>The P in PID is for proportional error. The proportional error is the flat amount that we are from the target. For example, let's say that your Rigidboy is at 50 degrees and the goal is 90 degrees. This would mean that the proportional error is 40 degrees since that''s the difference between the two. As with the other two values, this is also multiplied by a gain factor to control how much contribution it has to the overall output value.</li>\n<li>The I in PID is for the integral error. The integral error is a sum of the proportional values. An integral error can be helpful if you have an opposing force acting on your Rigidbody. Image a situation where you're trying to rotate your Rigidbody to a specified angle but there's force pushing the Rigidbody in the opposite direction. The force might not be big so your Rigidbody might get to 85 out of 90 degrees with just proportional errors but the opposing force is always pushing you back by 5 degrees and your Rigidbody will be stuck at 95 degrees. The integral error comes in handy here because it keeps a running total of proportional values and will apply a bigger output if the desired output is not being achieved.</li>\n<li>The D in PID is for the derative error. The derative error is used to provide a way of dampening the motion of the body. This is used to slow down the motion so that we don't have to do too much over/under correction.</li>\n<li>Each of the errors are multiplied by a constant, called a gain, before they are finally all added together and returned as the output. These gain values are used to control how much that error contributes to the overall output. For our example we'll just experiment with the gain values in the inspector as our use is not very complicated.</li>\n<li>If this seems like a bunch of mumbo jumbo it's ok because it was to me too but stick around for the examples as maybe it'll click in the context of Rigidbodies.</li>\n</ul>\n<h2 id=\"project-setup\"><a href=\"#project-setup\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Project Setup</h2>\n<p>To set up the project for this article we're going to create a new 3D game add a spaceship model I got from a <a href=\"https://www.kenney.nl/assets/space-kit\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Kenney</a> kit. Next we add a Rigidbody to the model which we'll apply the torque to.</p>\n<p>Now we need to create two scripts: <code>PID</code> and <code>ShipController</code>. The PID script is where we're going to put all of the logic while the ShipController is going to use the values output by the PID controller to rotate the ship.</p>\n<p>Let's open up the <code>PID</code> script and create the controller.</p>\n<h2 id=\"creating-the-pid-controller\"><a href=\"#creating-the-pid-controller\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Creating the PID Controller</h2>\n<p>In the <code>PID</code> script we don't need to do anything on <code>Start</code> or <code>Update</code> so we can just delete those and we should be left with the following:</p>\n<pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Collections</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Collections<span class=\"token punctuation\">.</span>Generic</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEngine</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/// &lt;summary></span>\n<span class=\"token comment\">/// A simple PID controller component class.</span>\n<span class=\"token comment\">/// https://forum.unity.com/threads/rigidbody-lookat-torque.146625/#post-1005645</span>\n<span class=\"token comment\">/// &lt;/summary></span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PID</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">MonoBehaviour</span></span>\n<span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>The first thing we want to set up are the properties we need:</p>\n<ul>\n<li>We need the gain values discussed earlier, The proportional, integral, and derivative each need their own gain value. Values can be set to 0 to omit it from the final output (outside the scope of this tutorial).</li>\n<li>We need to set up the variables to track the current proportional, integral, and derative error values.</li>\n<li>We need to set up a variable to keep track of what the error was the last time the output was requested. This is used by the derivative error to calculate the rate of change.</li>\n</ul>\n<pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Collections</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Collections<span class=\"token punctuation\">.</span>Generic</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEngine</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/// &lt;summary></span>\n<span class=\"token comment\">/// A simple PID controller component class.</span>\n<span class=\"token comment\">/// https://forum.unity.com/threads/rigidbody-lookat-torque.146625/#post-1005645</span>\n<span class=\"token comment\">/// &lt;/summary></span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PID</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">MonoBehaviour</span></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// This is completely optional and is used just to help you idenfity what this PID</span>\n    <span class=\"token comment\">/// script is for as you can use multiple PID scripts per game object to control</span>\n    <span class=\"token comment\">/// various values.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> name<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// The gain of the proportional error. This defines how much weight the proportional</span>\n    <span class=\"token comment\">/// error has in the final output.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\"><span class=\"token keyword\">float</span></span> Kp <span class=\"token operator\">=</span> <span class=\"token number\">1.0f</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// The gain of the integral error. This defines how much weight the integral</span>\n    <span class=\"token comment\">/// error has in the final output.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\"><span class=\"token keyword\">float</span></span> Ki <span class=\"token operator\">=</span> <span class=\"token number\">0.0f</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// The gain of the derivative error. This defines how much weight the derivative</span>\n    <span class=\"token comment\">/// error has in the final output.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\"><span class=\"token keyword\">float</span></span> Kd <span class=\"token operator\">=</span> <span class=\"token number\">0.1f</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// Tracks the current values of the proportional, integral, and derative errors.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\"><span class=\"token keyword\">float</span></span> P<span class=\"token punctuation\">,</span> I<span class=\"token punctuation\">,</span> D<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// Used to keep track of what the error value was the last time the output was requested.</span>\n    <span class=\"token comment\">/// This is used by the derivative to calculate the rate of change.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\"><span class=\"token keyword\">float</span></span> previousError<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Believe it or not we're almost done with our simple PID controller here. We just need to create the method that takes in the current error and calculates the output which we pass to <code>AddTorque</code> in the <code>ShipController</code> script.</p>\n<pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token comment\">/// &lt;summary></span>\n<span class=\"token comment\">/// Returns the amount of torque that should be applied to the ship this frame</span>\n<span class=\"token comment\">/// to reach the target rotation.</span>\n<span class=\"token comment\">/// &lt;/summary></span>\n<span class=\"token comment\">/// &lt;returns></span>\n<span class=\"token comment\">/// The output of the PID calculation.</span>\n<span class=\"token comment\">/// &lt;/returns></span>\n<span class=\"token comment\">/// &lt;param name=\"currentError\">How far away the body is from the target rotation angle.&lt;/param></span>\n<span class=\"token comment\">/// &lt;param name=\"deltaTime\">The delta value from FixedUpdate.&lt;/param></span>\n<span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">float</span></span> <span class=\"token function\">GetOutput</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">float</span></span> currentError<span class=\"token punctuation\">,</span> <span class=\"token class-name\"><span class=\"token keyword\">float</span></span> deltaTime<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// First we set the proportional to how how far we are from the target value.</span>\n    P <span class=\"token operator\">=</span> currentError<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Since the integral is the sum of the proportional error over time we have</span>\n    <span class=\"token comment\">// to multiply the propertional by the delta time and then add it on to the</span>\n    <span class=\"token comment\">// current I value.</span>\n    I <span class=\"token operator\">+=</span> P <span class=\"token operator\">*</span> deltaTime<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token comment\">// Set the derative to the rate of change of error by subtracting the current</span>\n    <span class=\"token comment\">// error from the previous error to get the difference and then dividing it by</span>\n    <span class=\"token comment\">// the amount of time it took to get to this change.</span>\n    D <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>P <span class=\"token operator\">-</span> previousError<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> deltaTime<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Now we set the previous error to the current error to prepare for the next</span>\n    <span class=\"token comment\">// time the output is requested.</span>\n    previousError <span class=\"token operator\">=</span> currentError<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token comment\">// Finally calculate the output using the values above multiplied by their gain.</span>\n    <span class=\"token keyword\">return</span> P<span class=\"token operator\">*</span>Kp <span class=\"token operator\">+</span> I<span class=\"token operator\">*</span>Ki <span class=\"token operator\">+</span> D<span class=\"token operator\">*</span>Kd<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>And that's it for our PID class. If you're still a bit confused don't worry we still have example to get to. Also don't expect to fully understand PID controllers from this tutorial, but instead you should understand how to use them for tasks such as rotating Rigidbodies. If you really want to learn more about PID controllers there are great videos on the topic that helped me grasp the concept.</p>\n<h2 id=\"instancing-the-pid-script\"><a href=\"#instancing-the-pid-script\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Instancing the PID Script</h2>\n<p>Next we're going to make the script that gets attached to our ship and controls the Rigidbody using the PID output but before that we should attach our PID script to the ship.</p>\n<p>So back out in the inspector we click on our ship game object and drag over the PID script twice. You read it right we need two instances of the PID class because we want to control the angle of the Rigidbody but also the angular velocity so that we can avoid abrupt changes to the angular velocity when applying the torque to change the angle.</p>\n<p>This is also where the <code>Name</code> property in the PID script comes in handy. We can better distinguish them by naming the first one \"Angle Controller\" and the second one \"Angular Velocity Controller\".</p>\n<p>We're going to leave the public variables alone for now until we set up our ship and have a working demo.</p>\n<h2 id=\"ship-controls\"><a href=\"#ship-controls\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Ship Controls</h2>\n<p>Now to test our PID script we have to actually use it to change our ship's rotation.</p>\n<p>Same as before, open up the ShipController script and delete the <code>Start</code> and <code>Update</code> methods since we won't be using them and make sure you just have the following:</p>\n<pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token comment\">/// &lt;summary></span>\n<span class=\"token comment\">/// Used to control the ship and simulate the effects of the PID script.</span>\n<span class=\"token comment\">/// &lt;/summary></span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ShipController</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">MonoBehavious</span></span>\n<span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>First things we want to do here is set up the variables we'll need:</p>\n<ul>\n<li>We need a public variable that defines our turn speed. This will affect how fast we get to our final angle destination.</li>\n<li>We also need a public variable that defines the maximum angular velocity for our Rigidbody. This will help us avoid some crazy spins.</li>\n<li>Next we need a private variable that holds the current angle we want to rotate to.</li>\n<li>Also two more private variables, one for each of our scripts attached to the game object.</li>\n<li>Finally one more private variable that will hold the calculated torque to pass to <code>AddTorque</code>.</li>\n</ul>\n<pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token comment\">/// &lt;summary></span>\n<span class=\"token comment\">/// Used to control the ship and simulate the effects of the PID script.</span>\n<span class=\"token comment\">/// &lt;/summary></span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ShipController</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">MonoBehavious</span></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// The speed at which the ship will turn at.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\"><span class=\"token keyword\">float</span></span> turnSpeed <span class=\"token operator\">=</span> <span class=\"token number\">500.0f</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// The maximum angular velocity of the Rigidbody.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\"><span class=\"token keyword\">float</span></span> maxAngularVelocity <span class=\"token operator\">=</span> <span class=\"token number\">20.0f</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// The current angle to turn towards.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\"><span class=\"token keyword\">float</span></span> targetAngle<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// A reference to the PID instance for the angle.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">PID</span> angleController<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// A reference to the PID instance for the angular velocity.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">PID</span> angularVelocityController<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// The torque to apply to the Rigidbody.</span>\n    <span class=\"token comment\">/// &lt;/summary></span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Vector3</span> torque<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token comment\">/// A reference to the Rigidbody component.</span>\n    <span class=\"token comment\">/// &lt;summary></span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Rigidbody</span> rb<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>When the ship is initialized we:</p>\n<ul>\n<li>Get the reference to the Rigidbody so we can get the angular velocity and apply the torque later.</li>\n<li>Get the references to both PID controller instances.</li>\n<li>Set the Rigidbody's max angular velocity to the value set by the user in the public variable.</li>\n<li>Set the initial target angle to the Rigidbody's Y Euler angle.</li>\n</ul>\n<pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Awake</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Get the reference to the Rigidbody which will be used when we apply the torque.</span>\n    rb <span class=\"token operator\">=</span> gameObject<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">GetComponent</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>Rigidbody<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Get the references to the PID instances so we can use them as controllers.</span>\n    angleController <span class=\"token operator\">=</span> gameObject<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">GetComponents</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>PID<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    angularVelocityController <span class=\"token operator\">=</span> gameObject<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">GetComponents</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>PID<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Set the maximum angular velocity of the Rigidbody and set the initial value of the</span>\n    <span class=\"token comment\">// targetAngle to the Y Euler angle. We do this so that we can easily make adjustments</span>\n    <span class=\"token comment\">// by just adding or subtracting from it.</span>\n    rb<span class=\"token punctuation\">.</span><span class=\"token function\">SetMaxAngularVelocity</span><span class=\"token punctuation\">(</span>maxAngularVelocity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    targetAngle <span class=\"token operator\">=</span> transform<span class=\"token punctuation\">.</span>eulerAngles<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Now it's time for the fun stuff, the actual rotation and usage of the PID controllers. In the FixedUpdate we:</p>\n<ul>\n<li>Get the fixed delta time because we need to pass it to the PID controllers.</li>\n<li>Adjust the value of the <code>targetAngle</code> depending on the user input, the turn speed, and the fixed delta time.</li>\n<li>Get the angle error (the difference between our current angle and the angle we want to turn to) by using <code>DeltaAngle</code>. Then we pass this value to the <code>angleController</code> to get the torque that we should apply this frame.</li>\n<li>Get the negative of the angular velocity and pass this to the <code>angularVelocityController</code> to get the torque that we should apply this frame.</li>\n<li>Lastly add the two torques together and apply it to the Rigidbody.</li>\n</ul>\n<pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">FixedUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Get the fixed update delta time.</span>\n    <span class=\"token class-name\"><span class=\"token keyword\">float</span></span> dt <span class=\"token operator\">=</span> Time<span class=\"token punctuation\">.</span>fixedDeltaTime<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// So currently the targetAngle contains the current rotation of the ship.</span>\n    <span class=\"token comment\">// Now we need to set the targetAngle to a combination of the user's horizontal</span>\n    <span class=\"token comment\">// input, the turn speed, and fixed delta time.</span>\n    targetAngle <span class=\"token operator\">+=</span> Input<span class=\"token punctuation\">.</span><span class=\"token function\">GetAxis</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Horizontal\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> turnSpeed <span class=\"token operator\">*</span> dt<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// The angle controller drives the ship's angle towards the target angle.</span>\n    <span class=\"token comment\">// This PID controller takes in the error between the ship's current rotation angle</span>\n    <span class=\"token comment\">// and the target rotation angle as input, and returns a torque magnitude.</span>\n    <span class=\"token comment\">// We use `DeltaAngle` to find the shortest difference between the two angles in degrees</span>\n    <span class=\"token comment\">// which is what we need to pass to the PID controller.</span>\n    <span class=\"token class-name\"><span class=\"token keyword\">float</span></span> angleError <span class=\"token operator\">=</span> Mathf<span class=\"token punctuation\">.</span><span class=\"token function\">DeltaAngle</span><span class=\"token punctuation\">(</span>transform<span class=\"token punctuation\">.</span>eulerAngles<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">,</span> targetAngle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\"><span class=\"token keyword\">float</span></span> torqueCorrectionForAngle <span class=\"token operator\">=</span> angleController<span class=\"token punctuation\">.</span><span class=\"token function\">GetOutput</span><span class=\"token punctuation\">(</span>angleError<span class=\"token punctuation\">,</span> dt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// The angular velocity controller drives the ship's angular velocity to 0.</span>\n    <span class=\"token comment\">// This PID controller takes in the negated angular velocity of the ship and returns</span>\n    <span class=\"token comment\">// a torque magnitude.</span>\n    <span class=\"token class-name\"><span class=\"token keyword\">float</span></span> angularVelocityError <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>rb<span class=\"token punctuation\">.</span>angularVelocity<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\"><span class=\"token keyword\">float</span></span> torqueCorrectionForAngularVelocity <span class=\"token operator\">=</span> angularVelocityController<span class=\"token punctuation\">.</span><span class=\"token function\">GetOutput</span><span class=\"token punctuation\">(</span>angularVelocityError<span class=\"token punctuation\">,</span> dt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// The total torque from both controller is now applied to the ship. If the gains</span>\n    <span class=\"token comment\">// are set correctly then the ship should rotate to the correct angle and stay there.</span>\n    torque <span class=\"token operator\">=</span> transform<span class=\"token punctuation\">.</span>up <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>torqueCorrectionForAngle <span class=\"token operator\">+</span> torqueCorrectionForAngularVelocity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\trb<span class=\"token punctuation\">.</span><span class=\"token function\">AddTorque</span><span class=\"token punctuation\">(</span>torque<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>At this point you should add the <code>ShipController</code> script to the Ship GameObject and your ship should look something like this in the inspector:</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 552 876' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-13ea995394e0e8f435c565fd656a2942'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-13ea995394e0e8f435c565fd656a2942)' width='552' height='876' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAABmCAYAAAB7nJf1AAAACXBIWXMAAA7DAAAOwwHHb6hkAAASXElEQVR42tWc95MTxxLH919%2br1yUy/7B5bJd5QDPBBtjMBiwiUeGu4Pjko6TdIGLHEdyzjnH4od5%2brT8HbcWhZW0ko4funa0mt2Z6encPZuUy%2bVw5syZUCgUwuTkZCgWi2F6ejrcuHHD7s3OzoalpaUwNTUVjh49Go4dO/bYwvHjx8Nbb70VDh8%2bbPDOO%2b%2bEhIW%2b%2buqr4fz58%2bHNN980eOmll2yxtN99911DAEjhIX7z4OMKu3fvDvv37w8HDhwIR44cCcnNmzfD6upqWF5etoVCEfPz82FxcdGAe/QplUphfHw8TExMPFYAVXNlA2dmZoyqAX4DCQseHh4O165dC3Nzc7ZokKHFg4y1tbVw79698MEHH4T333//sQDm%2buDBA9vc27dv2zqgdtbLOhcWFirXckguX75s/AF5gCkWz46vrKwYwDevvfZaePvtt8Mvv/wSfv755wj87jX4sdoZ87fffgvff/99uHv3rl2h3n379oVdu3YZCwwPXwljY2MhgSzOnDkbhoZOh5GRkSCWAEQFYAvheOfOHcPm5uamwfr6ulFHp8DzGxsbdr1165a1AcZQmzH9uFz1bKt3swbmzprYeSiA9QLcZ22J%2bJsFTk5OWBtEwB%2bQCiB%2bATwPMRlNsBNggZAmVMf4erd4lgmzc6Ojo3FMJn///n1DRpYxoAAAFuY5ANaoUvlySNhlfgDi/aGhISOVixcvmhqETS5cuBAOHTpkZHT69GmTGeK1TuDDDz%2b0iSwszBsiQDya6ODBg%2bH1118PZ8%2betV3jHm3mcO7cOUPKxx9/3NbYXja89957dm9xccGoxIRguSIMyuXKblegXC5FgcGkAAkO2uwAv2mDnG6Bd7H7ugK8W%2bP5sTUuc2tnDD2rNlfeyVgJZDU1VYGZiTBWuF65We3AQmEFBpNxJEOJ//JYPJBlMe0u2APzhaWgWNrXr1%2bP6pD3Jizq2uhIuFSYC5dOHA8rCIcKK/An5IgGePnll8Ozzz4bdu7cGXbs2GGGExiVjdAJ8Gwr6Ka/ADI/efKksTRa7dSpUyYAWTeUnhh5VKBQWgylqUKYKxXtD5EkquLq1asGwiSCSeQksm0Fxmr/kDC/QXAzEJmKfFv1F8vqGc8q7LiEqig6UgANWODC%2bXNhrEIewxWyv3Tpki0cLNUjRfkJWYH%2bQiK7glRGkCEI6wH/sXMSwgjnRn09sFCEJYIcwaoxPvroIwO1uX7yySemScwXYGcxdJDw2MqQ%2bBtvvGGSnwl49SeQPm0F9AXjSHO0BzuEJMZQ%2bfHHH8NPP/1UA9zDkEFSnzhxwp6HAn744YdH%2bnrASMJh4xnGQEX7MfxYGgMEJVqMl/iSxCy%2bncU2Q4Koh92BF8XXjeSDyJ650F996z2je4wFEuBxjKBWY4AoswQhdXmCCD48JaiBXRMSOkWEpwDcbuQLu8vuNNrNX3/91fpgnvMOnmHX2OVmFMBYmO70h7x///33pmPABokEBPyGAYTExPDA7ZUa7BYBvAPhiQxgd%2bBPeLGeMcM9eBQZINUF1WQxfFgHc2YMzOFWYzCPRJOE3xkQsxOAPDwLtCP06glBvZuFffrppw2BXfn8889tcpJBmK/c479mzzIOz8Ay8HerMRDGiXbq4KGDYf%2bB/ab3If9udj1NATJzEYI4Pd9%2b%2b62RdD1A2EHO7BL9eQcmM/f4r9FzkDX8DwXD/19%2b%2baXd4xmB3q8xoJBETs5cqWIGF0tRV0ryeyfIO0XtABMTQmQD0G6m0z3yZX026y9keytVz/vfUuN6JpmoeICFigF07NLxMDQ8FGYKVUkKYDbKBKatuGG3yMgC3TyTvodNI49S9g2qn/8TGtdHx8Ley/vCE4e3heJcMayurIYbszfCU089FZ5%2b%2bunw3HPPhWeeeSbs3bs3vPDCC3b15mcWE1VtjJp%2bAeMhSzB/sW9gDdoIVRCDsEyk/4vlYjgzdjaUyv/aAuw6auXKlSsmwcEibSxFmbVZQaRfz6jqNdgmOwqW6jcWEDkPXxkO49fGrSO2vnhOyPDelQ9eZAHeDxLYDdRPN3GETmMPgNqMjwCMahBe2L1nd9i5a2fYs2ePxQjlAjfasXY1AWqVqIwMIB9bHAQwDzOE6u2WpHYealDvgZKwz1GDWwHYfYsJpp0h/Gb4vB6/eoOoHQRI4EBVmKCYqOwA10EAY//555/hs88%2b%2b9cURj1grUH%2byAFZghJi3ThGMobAeDdB1DwBKxCtkMhUZeFYUfjTXJH%2bWGKkyFAdmJid%2bgWiANTh119/bZbgN998Y9dBAGOTK0AYRlMYBJD7IyILO5A3IwrLfRKKQKeeoWQALPDVV18ZEgYJzAFEEJeILABA%2buhH2IE2sgH9LyrplAV4t4SgtM5WAMsNyihgp1955RXbeeICUAKOEWoRNujGLWYwLDOwjyzIS7vkATEiJPXnawPUCUroRi2KghCsearXXBCg9BM7T9IQO5%2boEDFB2lAAMsGnlzuhAHx0%2bA45wO9%2bm8P17B2uMSACr0sVKihC2hzALugGAVKDSlMDyjINCuSbRBmAykMOEBYjsooq1L10cUHaMMqqBVCnCFfCVvzGFPWh6n4B41UDpyv/%2bgIsliAksUAsQlgC4Qc7IAOEMR9cyEoN0gLSLlAb91FDBC%2bVEu8HaCy5y5EFmJgCl1KByAbPEiwAdqDdjmBUsRXvA5FKTDIO7NBtnUEnwBwsNSYWwPJD4BE4ABQil3/APQwlVKNPnWdBgGoNeIbYIFYlFifUxjsIUBLE7BcQGF1eXqqmx6WipAKZkKS0d4hkPKjdjmOkfulcopIfg9ACYuMEKc/uA6g97TzpMX6jDhFePsjYrgbQtVGccKBqUJOAP5HOAHwOmUKytLnXrRbYKobPI4YQQg6nB/VHCQwUoRCYroMi035AgiRmp0%2bdPmVqj7SYhFsr8tyqu9oOFSYSCOXZUpgvzcfIKYJOgRAFSH2NjQQnfbc6SKCrrfVxNQqYHJsM20/vCP898ERYmK%2bmlvlTFWGEwb2gRH1BKb6QaisCLIzFB4ujwtH7UDvzZt1mCk8XKmbu5EzYcfZ/4T%2bHnojVFezyiy%2b%2bGLZv324Lx1HCFnj%2b%2beftHr8V5VFdcSNQH/oD/l6vgc1k0Vi2jIkdwn2l3RMTdtQFlefD0sJSLCfjTzw4FRqovpY2V5XSZeVBucODcIRUO6S2L/VJ5O8T8sIGgFTQ%2b%2bwwWgHLDx/B593a0d%2byNLG/QSi7QYKi25R7p3o/Pe8aZwjeRh1CJiACjxBE4B12ExLj/Zid8i2Iyyu7tGUiQpCm9D7kgqcEr4hkO40DeGdIcmArhcViRAhyZ6cxfeUAURjpKyu7jQkSjvbqqJ20es8MIR8RYqLIA%2bUDUB/dZITSARGSERKgvg5YoNMqgPrpfpZCyazgCyViWJzIDxSAAEQGoPrg1zxK5ZQchZpUnkYgRMYW8gH24Kp4gbSR6guIKENBzUBxf/873Ye4JCkxNjqWyelAFOVxCD12H50PInwqvFME8H4WiJ8BEnivqA3A8eI/FswVwwthjBNGEAZg0gD%2bPKG0NHCfuAK1QSqmor/%2b05X7RKJU%2bB1ZgInI12fCvg4gjyJJ5AxXNIDKYTUxfjMxYnVcWQipdJ4BcbAOFIEcQYWygHrA%2bwm0KAsN5UBpOifggbHpFyNC7DqJEVWEowK7LZL0EWGKJGEx3sniyNKq%2bFEFkLqSQWbSzInNkDUHIniu3tkhnmHzsPhAkpKxkD3/pc8h1dQHeKEAptv197NSARTFLuqcEFd%2b64CWB2WnufqgaaP%2by/%2bU%2bDMeVKM6AChAxwJ9X65WI6TFgjl2nV1S/Uye4Sd2EK2CZBdCkAfU7H333XcREFLcozgSwawDTghk2DTd3wPvRYhD%2bvSFApAfsBbP8W4/BpSSyE5n8ceOV4/PQUrdWH7e/lcSQgVWRGQVa2SSCC143gP3yOHDzzzLglDTPFOvP/DFF1/Y/whYqEuUwFjwPP%2bnxwDJSTxhOTEZpiertj7YVo2gJur9a/nSqiFU2/dTZZZA/yHY/HsYqx6wcwrN6/3qrwyW76uDHBpXc/QxC/WRZrFzgxYPvD4elteWQ3mlenAK0gFz%2bPyoJCiB3dOk2A1eBLb5zX3IW6l1DaRTIr6kLl1e5/ukod3%2b9Z5BhjBf5gr7QYnSbtVDU4XpcG30Wli5txrKd%2bfC%2bup6uHuvqnaIDG/bts20Ao4SV2IBnCHivyeffNJMZniVe2gQ4gUcvsaQ0uHEdK2%2bjxPUiwt0eg6p3jiwHDYFJj7CT/EAKMPiAabvS8VQLpXD4vxCzWEJ1ejSWaEx2Qe%2bZtDX5CqPWO9kmd4tE9jvmED3s55FynpeSVpF89AYsVDSUl5XqykwLDCfwm5HI9Tra7nBCoI3NjfC/ELV69TBLO26fAD%2bg2p6nSNU%2bW6sEcIElaqC96WqOnF909rDnKEKAtburBsCrDK1Mp6ElASkEqeMi%2b7vZZ2gPhEQTWF2XRNHgAGSvDKTG9ULZqEIO2d4cyme5fPmafroO/d0zrdXwDgxNwhfIMioC1IECGFHZTjCjvhAs%2bRIK4tR8YDCTCHqdsxTb/6mTeJeQs2ZIU1cxolMYihAbOAPM/rCSQU3WxlM8geUmpaJOkjA0MIcjjFB1ATA7uMakyDFPOYebeSCaoZQibjO1A5lkRMgFgrAPsAub3ZirF9QQwFMEOF38tRJu%2bKf472xcBZLhAjtwH/Y2vxHWwcbs0Rk5WQheeE/zgEBjVzbPEDv92OpzRygxERmomV5ZmtL5P1BSn82V9EaxRGygISqLMd%2bgo7HqK1SHcAQMHJlJKzeWwvFzYoOXqxKahaIRYcwZLeJEEENsAc5BNogopMMT16WXlZLEIol5wEbYhWyiWxezAxNT02HpfWlsLK5YtagDBLInWgx/gDsAM%2bjJSQrlHuTEdMMRDnpIGivgfmh4rVwfS2HjYeik3hMbbpgJ8Z85FQT9eakoJ30VswLLCxGZGRBWl6gz4OoLSOINcWAiAm/ixfsCsnIFG50ZrAd01hFUhv3N%2bxQlsUHZ2%2bYMPIfOfHtvMG/F0NI30uKdoAXVgiJvENiUNH67VvGk8o6KSymICbteiGsXoCyVNEOgKcBqbhuSmPr2QFKhrAwqEHf%2bVGeQHFA%2bhOx1cGGXkHNgQkQgJDAyEHYIfh8XDAPBEhuYFAp28ziMY19pIZ5QKYcalCoK2%2boCYlpgkzCf0ihF6fG2GUWp3wAQUmf2OBKMkOx/3rx/LyAMcwQEgWw%2b%2bhKL%2bDypACF2eBxTGF9EqPRSfBegj6hUeMM6bB0L%2br6ZApL6A3aEXrEGYLfoQDl5/Iug/PnBtmB9FfpBnpyNJ0ezyMf0MgdBuPwda%2bDHVkAG8QCIqIAVCASOF0I3S2IArDAuIIE1BBSfpDAHOzYnAoecW6OHD1SEwtsFfbKmh2iL4YHqg7dj47v5/lBLdq347lBpcPxA2ZnZmu%2bxelT5L5aXAhq9/ueSr8r5tiPb4rKDVesUy65wFJjoyOj5g0WV4vVb4nMVUtSiPrg%2biIcVTKDpUiARMUT9WL7zbI2WfvmAYyF8CXaDYX7StGaAonxsfGwtFkxUe/Mh%2bWb1W%2bK8icxAGoGkA3EBXCDyQSRIcJi7CQeoGpRVYz2EhgDmaMPNXKPNvdlnSYxU1IqW7WoL5Ovfnl1ribD4jND7RYnFWeLPcv%2bNAN9LVdtH%2bmKMUGCHtjllytX2ml3uGOYKURsbz7YtMTIzD%2bmMepILrB3ib1rnIZOXeH0%2b%2bVtRkvQH5YEEWlvsJvzAnKHV26txI%2b0ql7IfwXWfw3W/9YVUIVHN8A7VJIXnSFygyye8BGOUd6%2bwNz8XFhbXTPfn53XZ3OVJ%2bDKbxbPDulTu0yYq2IEqC7vPLULKs7C6cIcjoYQLjACD0GHU5S3Owy2eSeaBIDa%2bM2idC4JNYVFqgQpGyILlf7EKJl8q89qtYKaT2n5mF2jvF9eprCiPQqAsMv6vrDAf2SZq/73pz7zOD3KXCwkJp2IeiPqm0dpbKPT4/okL23ejfkN6T98%2bDB%2bVOWPP/6IHzvx7bw/ovLXX39ZYCQKQaIxSP9eUoAisRJE/Kdixn6eH9Znuo0CtEPsfl61wc0%2bopLmQ9rE5/xn7/oBNTKACVImBxX0AgEKiQGUwhKXQwor5seVyfTr7DBjoRGiFgABsgHyjAang6IIOH1IXQkKZBD3VDPcL3ikVhj1h/OT92e0PAuoUAlWU0IWowsE/P3337Hmt9fAOAhYqLGmVrgXu%2b/fp4oyFVgMwi/wH3BnDv8HlcNvfMjMYgQAAAAASUVORK5CYII=' /%3e%3c/svg%3e\" width=\"552\" alt=\"Inspector\" data-srcset=\"/assets/static/inspector.59bd7de.a1b8a8d45dbb07b1b3bca3a903d81c10.png 552w\" data-sizes=\"(max-width: 552px) 100vw, 552px\" data-src=\"/assets/static/inspector.59bd7de.a1b8a8d45dbb07b1b3bca3a903d81c10.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/inspector.59bd7de.a1b8a8d45dbb07b1b3bca3a903d81c10.png\" width=\"552\" alt=\"Inspector\"></noscript></p>\n<h2 id=\"the-gain-values\"><a href=\"#the-gain-values\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>The Gain Values</h2>\n<p>Now we have to go back to the inspector and fill out the gains for both PID controllers. This can be done by running the scene and tweaking the values until you find a nice combination or you can use a set of values below highlighted by the forum poster:</p>\n<h3 id=\"critically-damped-controls\"><a href=\"#critically-damped-controls\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Critically Damped Controls</h3>\n<p>These gain values result in a control system that's critically damped, or at least very close to it. This means that there is the smallest amount of oscillation, which is probably not even noticable. So in our example that means that when the ship is turned, it will stay where it is.</p>\n<p><strong>Angle Controller</strong></p>\n<table>\n<thead>\n<tr>\n<th>Gain</th>\n<th>Value</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Kp</td>\n<td>9.244681</td>\n</tr>\n<tr>\n<td>Ki</td>\n<td>0</td>\n</tr>\n<tr>\n<td>Kd</td>\n<td>0.06382979</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Angular Velocity Controller</strong></p>\n<table>\n<thead>\n<tr>\n<th>Gain</th>\n<th>Value</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Kp</td>\n<td>33.7766</td>\n</tr>\n<tr>\n<td>Ki</td>\n<td>0</td>\n</tr>\n<tr>\n<td>Kd</td>\n<td>0.2553191</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"fast-controls\"><a href=\"#fast-controls\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Fast Controls</h3>\n<p>These gain values result in a control system that has fast controls meaning that the turning is very responsive and quick in comparison to other gain values.</p>\n<p><strong>Angle Controller</strong></p>\n<table>\n<thead>\n<tr>\n<th>Gain</th>\n<th>Value</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Kp</td>\n<td>33.51064</td>\n</tr>\n<tr>\n<td>Ki</td>\n<td>0</td>\n</tr>\n<tr>\n<td>Kd</td>\n<td>0.02127661</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Angular Velocity Controller</strong></p>\n<table>\n<thead>\n<tr>\n<th>Gain</th>\n<th>Value</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Kp</td>\n<td>46.54256</td>\n</tr>\n<tr>\n<td>Ki</td>\n<td>0</td>\n</tr>\n<tr>\n<td>Kd</td>\n<td>0.1808511</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"spongy-controls\"><a href=\"#spongy-controls\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Spongy Controls</h3>\n<p>These gain values result in a control system that has slow, less responsive controls.</p>\n<p><strong>Angle Controller</strong></p>\n<table>\n<thead>\n<tr>\n<th>Gain</th>\n<th>Value</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Kp</td>\n<td>0.7093059</td>\n</tr>\n<tr>\n<td>Ki</td>\n<td>0</td>\n</tr>\n<tr>\n<td>Kd</td>\n<td>0</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Angular Velocity Controller</strong></p>\n<table>\n<thead>\n<tr>\n<th>Gain</th>\n<th>Value</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Kp</td>\n<td>11.17021</td>\n</tr>\n<tr>\n<td>Ki</td>\n<td>0</td>\n</tr>\n<tr>\n<td>Kd</td>\n<td>0</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"springy-controls\"><a href=\"#springy-controls\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Springy Controls</h3>\n<p>These gain values result in a control system that has springy controls so when you turn the ship you'll notice that it overshoots the target angle and bounces back to the correct angle.</p>\n<p><strong>Angle Controller</strong></p>\n<table>\n<thead>\n<tr>\n<th>Gain</th>\n<th>Value</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Kp</td>\n<td>0.7093059</td>\n</tr>\n<tr>\n<td>Ki</td>\n<td>0</td>\n</tr>\n<tr>\n<td>Kd</td>\n<td>0.1648936</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Angular Velocity Controller</strong></p>\n<table>\n<thead>\n<tr>\n<th>Gain</th>\n<th>Value</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Kp</td>\n<td>0</td>\n</tr>\n<tr>\n<td>Ki</td>\n<td>0</td>\n</tr>\n<tr>\n<td>Kd</td>\n<td>0</td>\n</tr>\n</tbody>\n</table>\n<p>Note that the values are for a Rigidbody without a collision shape. You'll need to tweak your values if you add a collision shape.</p>\n<h2 id=\"conclusion\"><a href=\"#conclusion\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Conclusion</h2>\n<p>All that's left now is to play the scene and try turning the ship with the left/right arrow keys and seeing it in action. Feel free to try out different combinations of PID values while the game is running to find the perfect combination for you.</p>\n<p>Also check out the <a href=\"https://github.com/robertcorponoi/unity-pid-with-rigidbodies\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">repo</a> for this project for a more complex example.</p>\n"}}]}}},"context":{}}